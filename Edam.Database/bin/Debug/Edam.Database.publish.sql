/*
Deployment script for Edam.Database

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Edam.Database"
:setvar DefaultFilePrefix "Edam.Database"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL) 
BEGIN
    ALTER DATABASE [$(DatabaseName)]
    SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
    DROP DATABASE [$(DatabaseName)];
END

GO
PRINT N'Creating database $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS OFF,
                ANSI_PADDING OFF,
                ANSI_WARNINGS OFF,
                ARITHABORT OFF,
                CONCAT_NULL_YIELDS_NULL OFF,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER OFF,
                ANSI_NULL_DEFAULT OFF,
                CURSOR_DEFAULT GLOBAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY CHECKSUM,
                DATE_CORRELATION_OPTIMIZATION OFF,
                ENABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 60 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CREATE_STATISTICS ON(INCREMENTAL = OFF),
                MEMORY_OPTIMIZED_ELEVATE_TO_SNAPSHOT = OFF,
                DELAYED_DURABILITY = DISABLED 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (QUERY_CAPTURE_MODE = AUTO, DATA_FLUSH_INTERVAL_SECONDS = 900, INTERVAL_LENGTH_MINUTES = 60, MAX_PLANS_PER_QUERY = 200, CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 30), MAX_STORAGE_SIZE_MB = 1000) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE = OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET MAXDOP = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET LEGACY_CARDINALITY_ESTIMATION = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET PARAMETER_SNIFFING = PRIMARY;
        ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
        ALTER DATABASE SCOPED CONFIGURATION FOR SECONDARY SET QUERY_OPTIMIZER_HOTFIXES = PRIMARY;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET TEMPORAL_HISTORY_RETENTION ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating User [KifDbReader]...';


GO
CREATE USER [KifDbReader] FOR LOGIN [KifDbReader];


GO
PRINT N'Creating User [KifDbWriter]...';


GO
CREATE USER [KifDbWriter] FOR LOGIN [KifDbWriter];


GO
PRINT N'Creating User [KifReader]...';


GO
CREATE USER [KifReader] FOR LOGIN [KifReader];


GO
PRINT N'Creating User [KifReportReader]...';


GO
CREATE USER [KifReportReader] FOR LOGIN [KifReportReader];


GO
PRINT N'Creating Role Membership <unnamed>...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datareader', @membername = N'KifDbReader';


GO
PRINT N'Creating Role Membership <unnamed>...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datareader', @membername = N'KifDbWriter';


GO
PRINT N'Creating Role Membership <unnamed>...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datawriter', @membername = N'KifDbWriter';


GO
PRINT N'Creating Schema [B2B]...';


GO
CREATE SCHEMA [B2B]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [Common]...';


GO
CREATE SCHEMA [Common]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [Data]...';


GO
CREATE SCHEMA [Data]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [Helper]...';


GO
CREATE SCHEMA [Helper]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [IdBase]...';


GO
CREATE SCHEMA [IdBase]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [Object]...';


GO
CREATE SCHEMA [Object]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Schema [Reference]...';


GO
CREATE SCHEMA [Reference]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating Master Key Master Key...';


GO
CREATE MASTER KEY ENCRYPTION BY PASSWORD= N'qvnezzfcP!otvvM{|kv2Xf7JmsFT7_&#$!~<?zbkm{!o{{zq';


GO
PRINT N'Creating Certificate [kifCert]...';


GO
CREATE CERTIFICATE [kifCert]
    AUTHORIZATION [dbo]
    WITH SUBJECT = N'KIF Master Certicate', START_DATE = N'2022-10-29T12:19:20', EXPIRY_DATE = N'2100-01-01T00:00:00';


GO
PRINT N'Creating Symmetric Key [KifSymKey]...';


GO
CREATE SYMMETRIC KEY [KifSymKey]
    AUTHORIZATION [dbo]
    WITH ALGORITHM = AES_256
    ENCRYPTION BY CERTIFICATE [kifCert];


GO
PRINT N'Creating User-Defined Table Type [Reference].[ReferenceDataElementCollectionItem]...';


GO
CREATE TYPE [Reference].[ReferenceDataElementCollectionItem] AS TABLE (
    [SerialNo]  BIGINT        NOT NULL,
    [Name]      VARCHAR (128) NULL,
    [ValueType] SMALLINT      NULL,
    [KeyType]   SMALLINT      NULL,
    [ValueText] VARCHAR (128) NULL,
    PRIMARY KEY CLUSTERED ([SerialNo] ASC));


GO
PRINT N'Creating User-Defined Table Type [Reference].[ReferenceListGroupCollectionItem]...';


GO
CREATE TYPE [Reference].[ReferenceListGroupCollectionItem] AS TABLE (
    [SerialNo]       BIGINT        NOT NULL,
    [OrganizationId] VARCHAR (20)  NULL,
    [ReferenceId]    VARCHAR (20)  NULL,
    [GroupNo]        SMALLINT      NULL,
    [ListNo]         SMALLINT      NULL,
    [ReferenceDate]  DATETIME2 (7) NULL,
    [Comment]        VARCHAR (80)  NULL,
    PRIMARY KEY CLUSTERED ([SerialNo] ASC));


GO
PRINT N'Creating User-Defined Table Type [Reference].[ReferencePolicyValueItem]...';


GO
CREATE TYPE [Reference].[ReferencePolicyValueItem] AS TABLE (
    [SerialNo]       BIGINT         NOT NULL,
    [OrganizationId] VARCHAR (20)   NULL,
    [EntityId]       VARCHAR (20)   NULL,
    [PolicyNo]       SMALLINT       NULL,
    [Value]          VARCHAR (1024) NULL,
    PRIMARY KEY CLUSTERED ([SerialNo] ASC));


GO
PRINT N'Creating Table [B2B].[ExchangeDefinition]...';


GO
CREATE TABLE [B2B].[ExchangeDefinition] (
    [ItemNo]                  INT           IDENTITY (1, 1) NOT NULL,
    [DataOwnerID]             VARCHAR (20)  NULL,
    [ExchangeCode]            VARCHAR (40)  NULL,
    [SegmentName]             VARCHAR (128) NULL,
    [BaseEntityName]          VARCHAR (128) NULL,
    [SegmentEntityName]       VARCHAR (120) NULL,
    [Position]                VARCHAR (20)  NULL,
    [SegmentCode]             VARCHAR (20)  NULL,
    [SegmentRepeat]           VARCHAR (20)  NULL,
    [SegmentRequiredType]     VARCHAR (20)  NULL,
    [SegmentReference]        VARCHAR (20)  NULL,
    [DataElementID]           VARCHAR (20)  NULL,
    [DataElementType]         VARCHAR (20)  NULL,
    [DataElement]             VARCHAR (128) NULL,
    [DataElementDescription]  VARCHAR (512) NULL,
    [DataElementRequiredType] VARCHAR (20)  NULL,
    [DataType]                VARCHAR (20)  NULL,
    [MinimumLength]           SMALLINT      NULL,
    [MaximumLength]           SMALLINT      NULL,
    [Loop]                    VARCHAR (20)  NULL,
    [LoopLevel]               SMALLINT      NULL,
    [VersionID]               VARCHAR (40)  NULL,
    [UpdateSessionID]         VARCHAR (40)  NULL,
    [CreatedDateTime]         DATETIME2 (7) NOT NULL,
    [LastUpdateDateTime]      DATETIME2 (7) NOT NULL,
    [RecordStatusCode]        CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([ItemNo] ASC)
);


GO
PRINT N'Creating Table [B2B].[ExchangeCode]...';


GO
CREATE TABLE [B2B].[ExchangeCode] (
    [DataOwnerID]        VARCHAR (20)  NULL,
    [CodeID]             VARCHAR (40)  NOT NULL,
    [Description]        VARCHAR (128) NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [CreatedDateTime]    DATETIME2 (7) NOT NULL,
    [LastUpdateDateTime] DATETIME2 (7) NOT NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([CodeID] ASC)
);


GO
PRINT N'Creating Table [Data].[DataNote]...';


GO
CREATE TABLE [Data].[DataNote] (
    [CreatedDate]      DATETIME      NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    [OrganizationId]   VARCHAR (20)  NOT NULL,
    [AgentId]          VARCHAR (20)  NOT NULL,
    [ReferenceId]      VARCHAR (20)  NOT NULL,
    [NoteNo]           INT           IDENTITY (1, 1) NOT NULL,
    [NoteText]         VARCHAR (MAX) NOT NULL,
    [NoteTypeNo]       INT           NOT NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([NoteNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataBatch]...';


GO
CREATE TABLE [Data].[DataBatch] (
    [BatchNo]          INT          IDENTITY (1, 1) NOT NULL,
    [BatchId]          VARCHAR (40) NOT NULL,
    [DomainNo]         INT          NOT NULL,
    [GroupId]          VARCHAR (40) NULL,
    [SequenceNo]       INT          NULL,
    [VersionId]        VARCHAR (20) NULL,
    [CreatedDate]      DATETIME     NOT NULL,
    [LastUpdateDate]   DATETIME     NOT NULL,
    [OrganizationId]   VARCHAR (20) NOT NULL,
    [DataOwnerId]      VARCHAR (20) NOT NULL,
    [UpdateSessionID]  VARCHAR (40) NULL,
    [RecordStatusCode] CHAR (1)     NOT NULL,
    PRIMARY KEY CLUSTERED ([BatchId] ASC)
);


GO
PRINT N'Creating Table [Data].[DataAssetGroupType]...';


GO
CREATE TABLE [Data].[DataAssetGroupType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataCode]...';


GO
CREATE TABLE [Data].[DataCode] (
    [IdNo]             BIGINT        IDENTITY (1, 1) NOT NULL,
    [BatchNo]          INT           NOT NULL,
    [CodeSetNo]        BIGINT        NOT NULL,
    [CodeId]           VARCHAR (40)  NULL,
    [AlternateId]      VARCHAR (80)  NULL,
    [OrganizationId]   VARCHAR (20)  NULL,
    [VersionId]        VARCHAR (20)  NULL,
    [Description]      VARCHAR (512) NOT NULL,
    [CategoryId]       VARCHAR (20)  NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataKeyType]...';


GO
CREATE TABLE [Data].[DataKeyType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataCodeSetBatch]...';


GO
CREATE TABLE [Data].[DataCodeSetBatch] (
    [OrganizationId]   VARCHAR (20)  NULL,
    [DomainNo]         INT           NOT NULL,
    [CodeSetNo]        BIGINT        NULL,
    [BatchNo]          INT           IDENTITY (1, 1) NOT NULL,
    [BatchId]          VARCHAR (40)  NOT NULL,
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([BatchNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataKind]...';


GO
CREATE TABLE [Data].[DataKind] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataCodeSet]...';


GO
CREATE TABLE [Data].[DataCodeSet] (
    [OrganizationId]   VARCHAR (20)   NULL,
    [DomainNo]         INT            NOT NULL,
    [CodeSetNo]        BIGINT         IDENTITY (1, 1) NOT NULL,
    [CodeSetId]        VARCHAR (20)   NULL,
    [CodeSetUri]       VARCHAR (2048) NOT NULL,
    [CodeSetName]      VARCHAR (128)  NULL,
    [VersionId]        VARCHAR (20)   NULL,
    [DataOwnerId]      VARCHAR (20)   NULL,
    [CreatedDate]      DATETIME2 (7)  NOT NULL,
    [LastUpdateDate]   DATETIME2 (7)  NOT NULL,
    [UpdateSessionID]  VARCHAR (40)   NULL,
    [RecordStatusCode] CHAR (1)       NOT NULL,
    PRIMARY KEY CLUSTERED ([CodeSetNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataReferenceType]...';


GO
CREATE TABLE [Data].[DataReferenceType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataConstraintType]...';


GO
CREATE TABLE [Data].[DataConstraintType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataGroupType]...';


GO
CREATE TABLE [Data].[DataGroupType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataElementType]...';


GO
CREATE TABLE [Data].[DataElementType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataCodeElement]...';


GO
CREATE TABLE [Data].[DataCodeElement] (
    [IdNo]             BIGINT        IDENTITY (1, 1) NOT NULL,
    [CodeSetNo]        BIGINT        NOT NULL,
    [ElementNo]        INT           NULL,
    [ElementPath]      VARCHAR (512) NOT NULL,
    [OrganizationId]   VARCHAR (20)  NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataNoteType]...';


GO
CREATE TABLE [Data].[DataNoteType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataReferenceStatus]...';


GO
CREATE TABLE [Data].[DataReferenceStatus] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataDomainType]...';


GO
CREATE TABLE [Data].[DataDomainType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataAssociationType]...';


GO
CREATE TABLE [Data].[DataAssociationType] (
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    [IdNo]               INT           NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataGroup]...';


GO
CREATE TABLE [Data].[DataGroup] (
    [CreatedDate]      DATETIME       NOT NULL,
    [LastUpdateDate]   DATETIME2 (7)  NOT NULL,
    [GroupNo]          INT            IDENTITY (1, 1) NOT NULL,
    [GroupId]          VARCHAR (20)   NULL,
    [GroupTypeNo]      INT            NOT NULL,
    [AlternateID]      VARCHAR (40)   NULL,
    [GroupURI]         VARCHAR (2048) NOT NULL,
    [Path]             VARCHAR (2048) NULL,
    [Name]             VARCHAR (256)  NULL,
    [Description]      VARCHAR (1024) NULL,
    [StatusNo]         SMALLINT       NOT NULL,
    [UpdateSessionID]  VARCHAR (40)   NULL,
    [RecordStatusCode] CHAR (1)       NOT NULL,
    PRIMARY KEY CLUSTERED ([GroupNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataDictionary]...';


GO
CREATE TABLE [Data].[DataDictionary] (
    [CreatedDate]      DATETIME       NOT NULL,
    [LastUpdateDate]   DATETIME2 (7)  NOT NULL,
    [DictionaryNo]     INT            IDENTITY (1, 1) NOT NULL,
    [OrganizationId]   VARCHAR (20)   NOT NULL,
    [DataOwnerId]      VARCHAR (20)   NOT NULL,
    [Name]             VARCHAR (128)  NULL,
    [RootURI]          VARCHAR (2048) NOT NULL,
    [UpdateSessionID]  VARCHAR (40)   NULL,
    [RecordStatusCode] CHAR (1)       NOT NULL,
    PRIMARY KEY CLUSTERED ([DictionaryNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataReferenceObject]...';


GO
CREATE TABLE [Data].[DataReferenceObject] (
    [CreatedDate]      DATETIME       NOT NULL,
    [LastUpdateDate]   DATETIME2 (7)  NOT NULL,
    [ReferenceDate]    DATETIME       NOT NULL,
    [ReferenceId]      VARCHAR (20)   NOT NULL,
    [ReferenceTypeNo]  INT            NOT NULL,
    [AliasId]          VARCHAR (20)   NULL,
    [AlternateId]      VARCHAR (40)   NULL,
    [Description]      VARCHAR (1024) NULL,
    [StatusNo]         INT            NOT NULL,
    [UpdateSessionId]  VARCHAR (40)   NULL,
    [RecordStatusCode] CHAR (1)       NOT NULL,
    PRIMARY KEY CLUSTERED ([ReferenceId] ASC)
);


GO
PRINT N'Creating Table [Data].[DataElement]...';


GO
CREATE TABLE [Data].[DataElement] (
    [CreatedDate]                DATETIME       NOT NULL,
    [LastUpdateDate]             DATETIME       NOT NULL,
    [ReferenceDate]              DATETIME       NOT NULL,
    [OrganizationId]             VARCHAR (20)   NOT NULL,
    [DataOwnerId]                VARCHAR (20)   NOT NULL,
    [ExpiredDate]                DATETIME       NULL,
    [AssetNo]                    INT            NULL,
    [TypeNo]                     INT            NULL,
    [DomainNo]                   INT            NOT NULL,
    [Root]                       VARCHAR (1024) NOT NULL,
    [Domain]                     VARCHAR (2048) NOT NULL,
    [Type]                       VARCHAR (256)  NOT NULL,
    [Element]                    VARCHAR (256)  NULL,
    [ElementNo]                  INT            IDENTITY (1, 1) NOT NULL,
    [ParentNo]                   INT            NULL,
    [ElementId]                  VARCHAR (20)   NULL,
    [ElementURI]                 VARCHAR (2048) NOT NULL,
    [ElementName]                VARCHAR (80)   NOT NULL,
    [ElementType]                VARCHAR (20)   NULL,
    [ElementDataType]            VARCHAR (1024) NULL,
    [ElementPath]                VARCHAR (MAX)  NULL,
    [Description]                VARCHAR (MAX)  NOT NULL,
    [ElementSequenceID]          VARCHAR (128)  NULL,
    [ElementTypeNo]              INT            NOT NULL,
    [ElementGroupNo]             INT            NOT NULL,
    [ElementConstraintNo]        INT            NOT NULL,
    [ElementKeyTypeNo]           INT            NOT NULL,
    [AutoGeneratedTypeNo]        INT            NOT NULL,
    [StatusNo]                   INT            NOT NULL,
    [ValueTypeNo]                SMALLINT       NOT NULL,
    [MinLength]                  INT            NULL,
    [MaxLength]                  INT            NULL,
    [MinOccurrence]              INT            NULL,
    [MaxOccurrence]              INT            NULL,
    [Nillable]                   BIT            NULL,
    [DefaultValue]               VARCHAR (128)  NULL,
    [FixedValue]                 VARCHAR (128)  NULL,
    [SampleValue]                VARCHAR (128)  NULL,
    [PropertiesBagText]          VARCHAR (MAX)  NULL,
    [ProcessInstructionsBagText] VARCHAR (MAX)  NULL,
    [SchemaText]                 VARCHAR (MAX)  NULL,
    [OrdinalNo]                  INT            NULL,
    [SequenceID]                 VARCHAR (20)   NULL,
    [VersionID]                  VARCHAR (20)   NULL,
    [BatchId]                    VARCHAR (40)   NULL,
    [UpdateSessionID]            VARCHAR (40)   NULL,
    [RecordStatusCode]           CHAR (1)       NOT NULL,
    [ConstraintsText]            VARCHAR (MAX)  NULL,
    [KindNo]                     SMALLINT       NULL,
    [Tags]                       VARCHAR (128)  NULL,
    [OriginalName]               VARCHAR (128)  NULL,
    [OriginalDataType]           VARCHAR (128)  NULL,
    PRIMARY KEY CLUSTERED ([ElementNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataTerm]...';


GO
CREATE TABLE [Data].[DataTerm] (
    [CreatedDate]      DATETIME       NOT NULL,
    [LastUpdateDate]   DATETIME2 (7)  NOT NULL,
    [ReferenceDate]    DATETIME       NOT NULL,
    [OrganizationId]   VARCHAR (20)   NOT NULL,
    [DataOwnerId]      VARCHAR (20)   NOT NULL,
    [ExpiredDate]      DATETIME       NULL,
    [DomainNo]         INT            NOT NULL,
    [Root]             VARCHAR (1024) NOT NULL,
    [Domain]           VARCHAR (2048) NOT NULL,
    [Type]             VARCHAR (256)  NULL,
    [Element]          VARCHAR (256)  NULL,
    [TermNo]           INT            IDENTITY (1, 1) NOT NULL,
    [TermId]           VARCHAR (20)   NULL,
    [TermURI]          VARCHAR (2048) NULL,
    [TermName]         VARCHAR (1024) NOT NULL,
    [Description]      VARCHAR (MAX)  NOT NULL,
    [ConfidenceScore]  DECIMAL (6, 5) NULL,
    [StatusNo]         INT            NOT NULL,
    [UpdateSessionID]  VARCHAR (40)   NULL,
    [RecordStatusCode] CHAR (1)       NOT NULL,
    PRIMARY KEY CLUSTERED ([TermNo] ASC)
);


GO
PRINT N'Creating Table [Data].[DataDomain]...';


GO
CREATE TABLE [Data].[DataDomain] (
    [CreatedDate]      DATETIME2 (7)  NOT NULL,
    [LastUpdateDate]   DATETIME2 (7)  NOT NULL,
    [OrganizationId]   VARCHAR (20)   NOT NULL,
    [DataOwnerId]      VARCHAR (20)   NOT NULL,
    [TypeNo]           SMALLINT       NOT NULL,
    [Prefix]           VARCHAR (20)   NOT NULL,
    [Root]             VARCHAR (1024) NOT NULL,
    [Domain]           VARCHAR (2048) NULL,
    [DomainNo]         INT            IDENTITY (1, 1) NOT NULL,
    [DomainID]         VARCHAR (20)   NULL,
    [DomainURI]        VARCHAR (2048) NOT NULL,
    [DomainName]       VARCHAR (256)  NOT NULL,
    [Description]      VARCHAR (MAX)  NOT NULL,
    [UpdateSessionID]  VARCHAR (40)   NULL,
    [RecordStatusCode] CHAR (1)       NOT NULL,
    PRIMARY KEY CLUSTERED ([DomainNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseTypes]...';


GO
CREATE TABLE [IdBase].[IdBaseTypes] (
    [TypeNo]             SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (20)  NOT NULL,
    [Length]             INT           NOT NULL,
    [Template]           VARCHAR (128) NULL,
    [Required]           BIT           NOT NULL,
    [TableName]          VARCHAR (40)  NULL,
    [TypeName]           VARCHAR (40)  NOT NULL,
    PRIMARY KEY CLUSTERED ([TypeNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseExtensions]...';


GO
CREATE TABLE [IdBase].[IdBaseExtensions] (
    [ExtensionNo] SMALLINT      NOT NULL,
    [IdString]    VARCHAR (20)  NOT NULL,
    [Description] VARCHAR (40)  NOT NULL,
    [Length]      INT           NOT NULL,
    [Template]    VARCHAR (128) NULL,
    [Required]    BIT           NOT NULL,
    [TypeName]    VARCHAR (40)  NOT NULL,
    PRIMARY KEY CLUSTERED ([ExtensionNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseCounters]...';


GO
CREATE TABLE [IdBase].[IdBaseCounters] (
    [IdNo]        INT          NOT NULL,
    [IdString]    VARCHAR (20) NOT NULL,
    [Description] VARCHAR (40) NOT NULL,
    [IdCount]     INT          NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBasePrefixCounters]...';


GO
CREATE TABLE [IdBase].[IdBasePrefixCounters] (
    [OrganizationId]   VARCHAR (20)  NOT NULL,
    [PrefixId]         VARCHAR (2)   NOT NULL,
    [IdString]         VARCHAR (20)  NOT NULL,
    [Description]      VARCHAR (40)  NOT NULL,
    [IdCount]          INT           NOT NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    CONSTRAINT [pk_IdBasePrefixCounter] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [PrefixId] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseGroups]...';


GO
CREATE TABLE [IdBase].[IdBaseGroups] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseTypeExtensions]...';


GO
CREATE TABLE [IdBase].[IdBaseTypeExtensions] (
    [TypeNo]      SMALLINT NOT NULL,
    [ExtensionNo] SMALLINT NOT NULL,
    CONSTRAINT [pk_ibte00] PRIMARY KEY CLUSTERED ([TypeNo] ASC, [ExtensionNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseGroupMembers]...';


GO
CREATE TABLE [IdBase].[IdBaseGroupMembers] (
    [IdNo]    INT      NOT NULL,
    [GroupNo] SMALLINT NOT NULL,
    [TypeNo]  SMALLINT NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [IdBase].[IdBaseStatus]...';


GO
CREATE TABLE [IdBase].[IdBaseStatus] (
    [IdNo]             SMALLINT      NOT NULL,
    [IdString]         VARCHAR (20)  NOT NULL,
    [Description]      VARCHAR (40)  NOT NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectLanguages]...';


GO
CREATE TABLE [Object].[ObjectLanguages] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (60)  NOT NULL,
    [SpanishDescription] VARCHAR (60)  NOT NULL,
    [CultureCode]        CHAR (6)      NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectRequirables]...';


GO
CREATE TABLE [Object].[ObjectRequirables] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectSizes]...';


GO
CREATE TABLE [Object].[ObjectSizes] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectStatus]...';


GO
CREATE TABLE [Object].[ObjectStatus] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectApplicables]...';


GO
CREATE TABLE [Object].[ObjectApplicables] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectCheckables]...';


GO
CREATE TABLE [Object].[ObjectCheckables] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectValueQualifiers]...';


GO
CREATE TABLE [Object].[ObjectValueQualifiers] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectValueTypes]...';


GO
CREATE TABLE [Object].[ObjectValueTypes] (
    [IdNo]             SMALLINT      NOT NULL,
    [Description]      VARCHAR (40)  NOT NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectKeywordTypes]...';


GO
CREATE TABLE [Object].[ObjectKeywordTypes] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectStates]...';


GO
CREATE TABLE [Object].[ObjectStates] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectConditions]...';


GO
CREATE TABLE [Object].[ObjectConditions] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectSeverity]...';


GO
CREATE TABLE [Object].[ObjectSeverity] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (60)  NOT NULL,
    [SpanishDescription] VARCHAR (60)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectTypes]...';


GO
CREATE TABLE [Object].[ObjectTypes] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (60)  NOT NULL,
    [SpanishDescription] VARCHAR (60)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectScopes]...';


GO
CREATE TABLE [Object].[ObjectScopes] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectColors]...';


GO
CREATE TABLE [Object].[ObjectColors] (
    [IdNo]               INT           NOT NULL,
    [Color]              CHAR (9)      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Object].[ObjectRelevance]...';


GO
CREATE TABLE [Object].[ObjectRelevance] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (60)  NOT NULL,
    [SpanishDescription] VARCHAR (60)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceTypesGroupMembers]...';


GO
CREATE TABLE [Reference].[ReferenceTypesGroupMembers] (
    [IdNo]   SMALLINT NOT NULL,
    [TypeNo] SMALLINT NOT NULL,
    CONSTRAINT [pk_ReferenceTypesGroupMemberIdNoTypeNo] PRIMARY KEY CLUSTERED ([IdNo] ASC, [TypeNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceTypesGroups]...';


GO
CREATE TABLE [Reference].[ReferenceTypesGroups] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (40)  NOT NULL,
    [SpanishDescription] VARCHAR (40)  NOT NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceBaseTypes]...';


GO
CREATE TABLE [Reference].[ReferenceBaseTypes] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (80)  NOT NULL,
    [SpanishDescription] VARCHAR (80)  NOT NULL,
    [ForceComposedName]  BIT           NOT NULL,
    [ApplyToIndividual]  BIT           NOT NULL,
    [CategoryId]         VARCHAR (128) NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceTraceTypes]...';


GO
CREATE TABLE [Reference].[ReferenceTraceTypes] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (60)  NULL,
    [SpanishDescription] VARCHAR (60)  NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceObjects]...';


GO
CREATE TABLE [Reference].[ReferenceObjects] (
    [CreatedDate]    DATETIME         NOT NULL,
    [LastUpdateDate] DATETIME         NOT NULL,
    [ObjectNo]       BIGINT           IDENTITY (1, 1) NOT NULL,
    [TypeNo]         SMALLINT         NOT NULL,
    [EntityTypeNo]   SMALLINT         NOT NULL,
    [ReferenceGuid]  UNIQUEIDENTIFIER NOT NULL,
    [OrganizationId] VARCHAR (20)     NOT NULL,
    [ReferenceId]    VARCHAR (20)     NOT NULL,
    [AlternateId]    VARCHAR (40)     NOT NULL,
    [Alias]          VARCHAR (80)     NOT NULL,
    [Description]    VARCHAR (80)     NOT NULL,
    [StatusNo]       SMALLINT         NOT NULL,
    [PropertiesBag]  VARCHAR (MAX)    NULL,
    CONSTRAINT [pk_ReferenceObjectPk] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [ReferenceId] ASC)
);


GO
PRINT N'Creating Index [Reference].[ReferenceObjects].[ux_ReferenceObject]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [ux_ReferenceObject]
    ON [Reference].[ReferenceObjects]([ObjectNo] ASC);


GO
PRINT N'Creating Index [Reference].[ReferenceObjects].[ux_ReferenceObjectAlternateId]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [ux_ReferenceObjectAlternateId]
    ON [Reference].[ReferenceObjects]([OrganizationId] ASC, [ReferenceId] ASC, [AlternateId] ASC);


GO
PRINT N'Creating Table [Reference].[ReferenceTypes]...';


GO
CREATE TABLE [Reference].[ReferenceTypes] (
    [IdNo]               SMALLINT      NOT NULL,
    [IdPrefix]           CHAR (2)      NOT NULL,
    [Description]        VARCHAR (20)  NULL,
    [SpanishDescription] VARCHAR (20)  NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceDataEditTemplate]...';


GO
CREATE TABLE [Reference].[ReferenceDataEditTemplate] (
    [CreatedDate]       DATETIME2 (7) NOT NULL,
    [LastUpdateDate]    DATETIME2 (7) NOT NULL,
    [OrganizationId]    VARCHAR (20)  NOT NULL,
    [TemplateNo]        BIGINT        NOT NULL,
    [TemplateVersionId] VARCHAR (20)  NULL,
    [ResourceName]      VARCHAR (128) NOT NULL,
    [TemplateDefaultNo] BIGINT        NULL,
    [TemplateTypeNo]    SMALLINT      NULL,
    [TemplateData]      VARCHAR (MAX) NULL,
    [MapData]           VARCHAR (MAX) NULL,
    [GroupData]         VARCHAR (MAX) NULL,
    [Title]             VARCHAR (128) NOT NULL,
    [GroupNo]           BIGINT        NOT NULL,
    [ScopeNo]           SMALLINT      NULL,
    [StatusNo]          SMALLINT      NULL,
    [PostUpdateScript]  VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([TemplateNo] ASC)
);


GO
PRINT N'Creating Index [Reference].[ReferenceDataEditTemplate].[ReferenceDataEditTemplateByName]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [ReferenceDataEditTemplateByName]
    ON [Reference].[ReferenceDataEditTemplate]([ResourceName] ASC);


GO
PRINT N'Creating Table [Reference].[ReferencePolicyTypes]...';


GO
CREATE TABLE [Reference].[ReferencePolicyTypes] (
    [IdNo]               SMALLINT       NOT NULL,
    [GroupNo]            SMALLINT       NOT NULL,
    [ValueTypeNo]        SMALLINT       NOT NULL,
    [Value]              VARCHAR (1024) NOT NULL,
    [Description]        VARCHAR (80)   NULL,
    [SpanishDescription] VARCHAR (80)   NULL,
    [DataOwnerId]        VARCHAR (20)   NULL,
    [UpdateSessionID]    VARCHAR (40)   NULL,
    [RecordStatusCode]   CHAR (1)       NOT NULL,
    [CreatedDate]        DATETIME2 (7)  NOT NULL,
    [LastUpdateDate]     DATETIME2 (7)  NOT NULL,
    CONSTRAINT [pk_ReferencePolicyType] PRIMARY KEY CLUSTERED ([IdNo] ASC, [GroupNo] ASC)
);


GO
PRINT N'Creating Index [Reference].[ReferencePolicyTypes].[ux_ReferencePolicyType]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [ux_ReferencePolicyType]
    ON [Reference].[ReferencePolicyTypes]([IdNo] ASC);


GO
PRINT N'Creating Table [Reference].[ReferencePolicyGroups]...';


GO
CREATE TABLE [Reference].[ReferencePolicyGroups] (
    [IdNo]               SMALLINT      NOT NULL,
    [Description]        VARCHAR (60)  NULL,
    [SpanishDescription] VARCHAR (60)  NULL,
    [DataOwnerId]        VARCHAR (20)  NULL,
    [UpdateSessionID]    VARCHAR (40)  NULL,
    [RecordStatusCode]   CHAR (1)      NOT NULL,
    [CreatedDate]        DATETIME2 (7) NOT NULL,
    [LastUpdateDate]     DATETIME2 (7) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceDataEditGroup]...';


GO
CREATE TABLE [Reference].[ReferenceDataEditGroup] (
    [CreatedDate]    DATETIME2 (7) NOT NULL,
    [LastUpdateDate] DATETIME2 (7) NOT NULL,
    [OrganizationId] VARCHAR (20)  NULL,
    [GroupNo]        BIGINT        NOT NULL,
    [GroupName]      VARCHAR (80)  NULL,
    [ScopeNo]        SMALLINT      NULL,
    [StatusNo]       SMALLINT      NULL,
    [LinkData]       VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([GroupNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceTraceLog]...';


GO
CREATE TABLE [Reference].[ReferenceTraceLog] (
    [CreatedDate]    DATETIME     NOT NULL,
    [TraceDate]      DATETIME     NOT NULL,
    [SessionId]      VARCHAR (40) NULL,
    [TraceNo]        BIGINT       IDENTITY (1, 1) NOT NULL,
    [TypeNo]         SMALLINT     NOT NULL,
    [OrganizationId] VARCHAR (20) NOT NULL,
    [ReferenceId]    VARCHAR (20) NOT NULL,
    PRIMARY KEY CLUSTERED ([TraceNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceOrganizationPreferences]...';


GO
CREATE TABLE [Reference].[ReferenceOrganizationPreferences] (
    [CreatedDate]             DATETIME      NOT NULL,
    [OrganizationId]          VARCHAR (20)  NOT NULL,
    [ReferenceId]             VARCHAR (20)  NOT NULL,
    [CreatedBy]               VARCHAR (20)  NOT NULL,
    [DefaultLanguageNo]       SMALLINT      NOT NULL,
    [DefaultCountryCode]      CHAR (2)      NOT NULL,
    [DefaultPostalCode]       VARCHAR (20)  NOT NULL,
    [DefaultStateCode]        CHAR (2)      NOT NULL,
    [DefaultRegionCode]       CHAR (4)      NOT NULL,
    [DefaultRegionText]       VARCHAR (40)  NOT NULL,
    [DefaultProvinceCode]     CHAR (4)      NOT NULL,
    [DefaultProvinceText]     VARCHAR (40)  NOT NULL,
    [DefaultMunicipalityCode] CHAR (10)     NOT NULL,
    [DefaultMunicipalityText] VARCHAR (40)  NOT NULL,
    [DefaultCityCode]         CHAR (10)     NOT NULL,
    [DefaultCityText]         VARCHAR (40)  NOT NULL,
    [ServiceGlAccountID]      VARCHAR (30)  NOT NULL,
    [PreferencesBag]          VARCHAR (MAX) NULL,
    PRIMARY KEY CLUSTERED ([OrganizationId] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceDataEditGroupTemplate]...';


GO
CREATE TABLE [Reference].[ReferenceDataEditGroupTemplate] (
    [CreatedDate]    DATETIME2 (7) NOT NULL,
    [LastUpdateDate] DATETIME2 (7) NOT NULL,
    [OrganizationId] VARCHAR (20)  NOT NULL,
    [ReferenceId]    VARCHAR (20)  NOT NULL,
    [GroupNo]        BIGINT        NOT NULL,
    [TemplateNo]     BIGINT        NOT NULL,
    CONSTRAINT [pk_ReferenceDataEditGroupTemplate] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [GroupNo] ASC, [TemplateNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferencePolicies]...';


GO
CREATE TABLE [Reference].[ReferencePolicies] (
    [CreatedDate]    DATETIME       NOT NULL,
    [OrganizationId] VARCHAR (20)   NOT NULL,
    [ReferenceId]    VARCHAR (20)   NOT NULL,
    [GroupNo]        SMALLINT       NOT NULL,
    [TypeNo]         SMALLINT       NOT NULL,
    [Value]          VARCHAR (1024) NOT NULL
);


GO
PRINT N'Creating Table [Reference].[ReferenceList]...';


GO
CREATE TABLE [Reference].[ReferenceList] (
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    [OrganizationId]   VARCHAR (20)  NOT NULL,
    [GroupId]          VARCHAR (40)  NULL,
    [IdNo]             SMALLINT      NOT NULL,
    [Name]             VARCHAR (80)  NOT NULL,
    [StatusNo]         SMALLINT      NOT NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    CONSTRAINT [pk_ReferenceList] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [IdNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceDevices]...';


GO
CREATE TABLE [Reference].[ReferenceDevices] (
    [CreatedDate]    DATETIME     NOT NULL,
    [OrganizationId] VARCHAR (20) NOT NULL,
    [ReferenceId]    VARCHAR (20) NOT NULL,
    [DeviceId]       VARCHAR (60) NOT NULL,
    [Alias]          VARCHAR (80) NULL,
    [LastUpdate]     DATETIME     NOT NULL
);


GO
PRINT N'Creating Table [Reference].[ReferencePreference]...';


GO
CREATE TABLE [Reference].[ReferencePreference] (
    [CreatedDate]    DATETIME      NULL,
    [OrganizationId] VARCHAR (20)  NOT NULL,
    [ReferenceId]    VARCHAR (20)  NOT NULL,
    [PreferencesBag] VARCHAR (MAX) NULL,
    CONSTRAINT [pk_ReferencePreference] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [ReferenceId] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceListGroupItem]...';


GO
CREATE TABLE [Reference].[ReferenceListGroupItem] (
    [CreatedDate]    DATETIME2 (7) NOT NULL,
    [LastUpdateDate] DATETIME2 (7) NOT NULL,
    [OrganizationId] VARCHAR (20)  NOT NULL,
    [ListNo]         SMALLINT      NOT NULL,
    [GroupNo]        SMALLINT      NOT NULL,
    [ReferenceId]    VARCHAR (20)  NOT NULL,
    [ReferenceDate]  DATETIME2 (7) NULL,
    [Comment]        VARCHAR (80)  NULL,
    CONSTRAINT [pk_ReferenceListGroupItemPK] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [ReferenceId] ASC, [ListNo] ASC)
);


GO
PRINT N'Creating Table [Reference].[ReferenceListGroup]...';


GO
CREATE TABLE [Reference].[ReferenceListGroup] (
    [CreatedDate]      DATETIME2 (7) NOT NULL,
    [OrganizationId]   VARCHAR (20)  NOT NULL,
    [GroupNo]          SMALLINT      NOT NULL,
    [ListNo]           SMALLINT      NOT NULL,
    [Name]             VARCHAR (80)  NOT NULL,
    [SequenceNo]       SMALLINT      NOT NULL,
    [StatusNo]         SMALLINT      NOT NULL,
    [DataOwnerId]      VARCHAR (20)  NULL,
    [UpdateSessionID]  VARCHAR (40)  NULL,
    [RecordStatusCode] CHAR (1)      NOT NULL,
    [LastUpdateDate]   DATETIME2 (7) NOT NULL,
    CONSTRAINT [pk_ReferenceListGroup] PRIMARY KEY CLUSTERED ([OrganizationId] ASC, [GroupNo] ASC, [ListNo] ASC)
);


GO
PRINT N'Creating Default Constraint unnamed constraint on [B2B].[ExchangeDefinition]...';


GO
ALTER TABLE [B2B].[ExchangeDefinition]
    ADD DEFAULT (getutcdate()) FOR [CreatedDateTime];


GO
PRINT N'Creating Default Constraint unnamed constraint on [B2B].[ExchangeDefinition]...';


GO
ALTER TABLE [B2B].[ExchangeDefinition]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDateTime];


GO
PRINT N'Creating Default Constraint unnamed constraint on [B2B].[ExchangeDefinition]...';


GO
ALTER TABLE [B2B].[ExchangeDefinition]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [B2B].[ExchangeCode]...';


GO
ALTER TABLE [B2B].[ExchangeCode]
    ADD DEFAULT (getutcdate()) FOR [CreatedDateTime];


GO
PRINT N'Creating Default Constraint unnamed constraint on [B2B].[ExchangeCode]...';


GO
ALTER TABLE [B2B].[ExchangeCode]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDateTime];


GO
PRINT N'Creating Default Constraint unnamed constraint on [B2B].[ExchangeCode]...';


GO
ALTER TABLE [B2B].[ExchangeCode]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNote]...';


GO
ALTER TABLE [Data].[DataNote]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNote]...';


GO
ALTER TABLE [Data].[DataNote]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNote]...';


GO
ALTER TABLE [Data].[DataNote]
    ADD DEFAULT ((0)) FOR [NoteTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNote]...';


GO
ALTER TABLE [Data].[DataNote]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataBatch]...';


GO
ALTER TABLE [Data].[DataBatch]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataBatch]...';


GO
ALTER TABLE [Data].[DataBatch]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataBatch]...';


GO
ALTER TABLE [Data].[DataBatch]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataAssetGroupType]...';


GO
ALTER TABLE [Data].[DataAssetGroupType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataAssetGroupType]...';


GO
ALTER TABLE [Data].[DataAssetGroupType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataAssetGroupType]...';


GO
ALTER TABLE [Data].[DataAssetGroupType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCode]...';


GO
ALTER TABLE [Data].[DataCode]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCode]...';


GO
ALTER TABLE [Data].[DataCode]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCode]...';


GO
ALTER TABLE [Data].[DataCode]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataKeyType]...';


GO
ALTER TABLE [Data].[DataKeyType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataKeyType]...';


GO
ALTER TABLE [Data].[DataKeyType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataKeyType]...';


GO
ALTER TABLE [Data].[DataKeyType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeSetBatch]...';


GO
ALTER TABLE [Data].[DataCodeSetBatch]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeSetBatch]...';


GO
ALTER TABLE [Data].[DataCodeSetBatch]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeSetBatch]...';


GO
ALTER TABLE [Data].[DataCodeSetBatch]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataKind]...';


GO
ALTER TABLE [Data].[DataKind]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataKind]...';


GO
ALTER TABLE [Data].[DataKind]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataKind]...';


GO
ALTER TABLE [Data].[DataKind]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeSet]...';


GO
ALTER TABLE [Data].[DataCodeSet]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeSet]...';


GO
ALTER TABLE [Data].[DataCodeSet]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeSet]...';


GO
ALTER TABLE [Data].[DataCodeSet]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceType]...';


GO
ALTER TABLE [Data].[DataReferenceType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceType]...';


GO
ALTER TABLE [Data].[DataReferenceType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceType]...';


GO
ALTER TABLE [Data].[DataReferenceType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataConstraintType]...';


GO
ALTER TABLE [Data].[DataConstraintType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataConstraintType]...';


GO
ALTER TABLE [Data].[DataConstraintType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataConstraintType]...';


GO
ALTER TABLE [Data].[DataConstraintType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroupType]...';


GO
ALTER TABLE [Data].[DataGroupType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroupType]...';


GO
ALTER TABLE [Data].[DataGroupType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroupType]...';


GO
ALTER TABLE [Data].[DataGroupType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElementType]...';


GO
ALTER TABLE [Data].[DataElementType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElementType]...';


GO
ALTER TABLE [Data].[DataElementType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElementType]...';


GO
ALTER TABLE [Data].[DataElementType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeElement]...';


GO
ALTER TABLE [Data].[DataCodeElement]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeElement]...';


GO
ALTER TABLE [Data].[DataCodeElement]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataCodeElement]...';


GO
ALTER TABLE [Data].[DataCodeElement]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNoteType]...';


GO
ALTER TABLE [Data].[DataNoteType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNoteType]...';


GO
ALTER TABLE [Data].[DataNoteType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataNoteType]...';


GO
ALTER TABLE [Data].[DataNoteType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceStatus]...';


GO
ALTER TABLE [Data].[DataReferenceStatus]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceStatus]...';


GO
ALTER TABLE [Data].[DataReferenceStatus]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceStatus]...';


GO
ALTER TABLE [Data].[DataReferenceStatus]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomainType]...';


GO
ALTER TABLE [Data].[DataDomainType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomainType]...';


GO
ALTER TABLE [Data].[DataDomainType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomainType]...';


GO
ALTER TABLE [Data].[DataDomainType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataAssociationType]...';


GO
ALTER TABLE [Data].[DataAssociationType]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataAssociationType]...';


GO
ALTER TABLE [Data].[DataAssociationType]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataAssociationType]...';


GO
ALTER TABLE [Data].[DataAssociationType]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroup]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroup]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroup]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD DEFAULT ((0)) FOR [GroupTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroup]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD DEFAULT ((0)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataGroup]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDictionary]...';


GO
ALTER TABLE [Data].[DataDictionary]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDictionary]...';


GO
ALTER TABLE [Data].[DataDictionary]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDictionary]...';


GO
ALTER TABLE [Data].[DataDictionary]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceObject]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceObject]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceObject]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD DEFAULT (getutcdate()) FOR [ReferenceDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceObject]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD DEFAULT ((0)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataReferenceObject]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT (getutcdate()) FOR [ReferenceDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [ElementTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [ElementGroupNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [ElementConstraintNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [ElementKeyTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [AutoGeneratedTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [ValueTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [MinLength];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [MaxLength];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [MinOccurrence];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [MaxOccurrence];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataElement]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD DEFAULT ((0)) FOR [KindNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataTerm]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataTerm]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataTerm]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD DEFAULT (getutcdate()) FOR [ReferenceDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataTerm]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD DEFAULT ((0)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataTerm]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomain]...';


GO
ALTER TABLE [Data].[DataDomain]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomain]...';


GO
ALTER TABLE [Data].[DataDomain]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomain]...';


GO
ALTER TABLE [Data].[DataDomain]
    ADD DEFAULT ((0)) FOR [TypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Data].[DataDomain]...';


GO
ALTER TABLE [Data].[DataDomain]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseTypes]...';


GO
ALTER TABLE [IdBase].[IdBaseTypes]
    ADD DEFAULT ('') FOR [SpanishDescription];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseTypes]...';


GO
ALTER TABLE [IdBase].[IdBaseTypes]
    ADD DEFAULT ((0)) FOR [Required];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseTypes]...';


GO
ALTER TABLE [IdBase].[IdBaseTypes]
    ADD DEFAULT ('System.String') FOR [TypeName];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseExtensions]...';


GO
ALTER TABLE [IdBase].[IdBaseExtensions]
    ADD DEFAULT ((0)) FOR [Required];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseExtensions]...';


GO
ALTER TABLE [IdBase].[IdBaseExtensions]
    ADD DEFAULT ('System.String') FOR [TypeName];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBasePrefixCounters]...';


GO
ALTER TABLE [IdBase].[IdBasePrefixCounters]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBasePrefixCounters]...';


GO
ALTER TABLE [IdBase].[IdBasePrefixCounters]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBasePrefixCounters]...';


GO
ALTER TABLE [IdBase].[IdBasePrefixCounters]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseGroups]...';


GO
ALTER TABLE [IdBase].[IdBaseGroups]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseGroups]...';


GO
ALTER TABLE [IdBase].[IdBaseGroups]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseGroups]...';


GO
ALTER TABLE [IdBase].[IdBaseGroups]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseGroupMembers]...';


GO
ALTER TABLE [IdBase].[IdBaseGroupMembers]
    ADD DEFAULT ((0)) FOR [GroupNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseGroupMembers]...';


GO
ALTER TABLE [IdBase].[IdBaseGroupMembers]
    ADD DEFAULT ((0)) FOR [TypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseStatus]...';


GO
ALTER TABLE [IdBase].[IdBaseStatus]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseStatus]...';


GO
ALTER TABLE [IdBase].[IdBaseStatus]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [IdBase].[IdBaseStatus]...';


GO
ALTER TABLE [IdBase].[IdBaseStatus]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectLanguages]...';


GO
ALTER TABLE [Object].[ObjectLanguages]
    ADD DEFAULT ('') FOR [CultureCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectLanguages]...';


GO
ALTER TABLE [Object].[ObjectLanguages]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectLanguages]...';


GO
ALTER TABLE [Object].[ObjectLanguages]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectLanguages]...';


GO
ALTER TABLE [Object].[ObjectLanguages]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectRequirables]...';


GO
ALTER TABLE [Object].[ObjectRequirables]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectRequirables]...';


GO
ALTER TABLE [Object].[ObjectRequirables]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectRequirables]...';


GO
ALTER TABLE [Object].[ObjectRequirables]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectSizes]...';


GO
ALTER TABLE [Object].[ObjectSizes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectSizes]...';


GO
ALTER TABLE [Object].[ObjectSizes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectSizes]...';


GO
ALTER TABLE [Object].[ObjectSizes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectStatus]...';


GO
ALTER TABLE [Object].[ObjectStatus]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectStatus]...';


GO
ALTER TABLE [Object].[ObjectStatus]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectStatus]...';


GO
ALTER TABLE [Object].[ObjectStatus]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectApplicables]...';


GO
ALTER TABLE [Object].[ObjectApplicables]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectApplicables]...';


GO
ALTER TABLE [Object].[ObjectApplicables]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectApplicables]...';


GO
ALTER TABLE [Object].[ObjectApplicables]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectCheckables]...';


GO
ALTER TABLE [Object].[ObjectCheckables]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectCheckables]...';


GO
ALTER TABLE [Object].[ObjectCheckables]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectCheckables]...';


GO
ALTER TABLE [Object].[ObjectCheckables]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectValueQualifiers]...';


GO
ALTER TABLE [Object].[ObjectValueQualifiers]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectValueQualifiers]...';


GO
ALTER TABLE [Object].[ObjectValueQualifiers]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectValueQualifiers]...';


GO
ALTER TABLE [Object].[ObjectValueQualifiers]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectValueTypes]...';


GO
ALTER TABLE [Object].[ObjectValueTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectValueTypes]...';


GO
ALTER TABLE [Object].[ObjectValueTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectValueTypes]...';


GO
ALTER TABLE [Object].[ObjectValueTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectKeywordTypes]...';


GO
ALTER TABLE [Object].[ObjectKeywordTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectKeywordTypes]...';


GO
ALTER TABLE [Object].[ObjectKeywordTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectKeywordTypes]...';


GO
ALTER TABLE [Object].[ObjectKeywordTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectStates]...';


GO
ALTER TABLE [Object].[ObjectStates]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectStates]...';


GO
ALTER TABLE [Object].[ObjectStates]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectStates]...';


GO
ALTER TABLE [Object].[ObjectStates]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectConditions]...';


GO
ALTER TABLE [Object].[ObjectConditions]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectConditions]...';


GO
ALTER TABLE [Object].[ObjectConditions]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectConditions]...';


GO
ALTER TABLE [Object].[ObjectConditions]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectSeverity]...';


GO
ALTER TABLE [Object].[ObjectSeverity]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectSeverity]...';


GO
ALTER TABLE [Object].[ObjectSeverity]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectSeverity]...';


GO
ALTER TABLE [Object].[ObjectSeverity]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectTypes]...';


GO
ALTER TABLE [Object].[ObjectTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectTypes]...';


GO
ALTER TABLE [Object].[ObjectTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectTypes]...';


GO
ALTER TABLE [Object].[ObjectTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectScopes]...';


GO
ALTER TABLE [Object].[ObjectScopes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectScopes]...';


GO
ALTER TABLE [Object].[ObjectScopes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectScopes]...';


GO
ALTER TABLE [Object].[ObjectScopes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectColors]...';


GO
ALTER TABLE [Object].[ObjectColors]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectColors]...';


GO
ALTER TABLE [Object].[ObjectColors]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectColors]...';


GO
ALTER TABLE [Object].[ObjectColors]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectRelevance]...';


GO
ALTER TABLE [Object].[ObjectRelevance]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectRelevance]...';


GO
ALTER TABLE [Object].[ObjectRelevance]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Object].[ObjectRelevance]...';


GO
ALTER TABLE [Object].[ObjectRelevance]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTypesGroups]...';


GO
ALTER TABLE [Reference].[ReferenceTypesGroups]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTypesGroups]...';


GO
ALTER TABLE [Reference].[ReferenceTypesGroups]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTypesGroups]...';


GO
ALTER TABLE [Reference].[ReferenceTypesGroups]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceBaseTypes]...';


GO
ALTER TABLE [Reference].[ReferenceBaseTypes]
    ADD DEFAULT ((0)) FOR [ForceComposedName];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceBaseTypes]...';


GO
ALTER TABLE [Reference].[ReferenceBaseTypes]
    ADD DEFAULT ((0)) FOR [ApplyToIndividual];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceBaseTypes]...';


GO
ALTER TABLE [Reference].[ReferenceBaseTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceBaseTypes]...';


GO
ALTER TABLE [Reference].[ReferenceBaseTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceBaseTypes]...';


GO
ALTER TABLE [Reference].[ReferenceBaseTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceTypes]...';


GO
ALTER TABLE [Reference].[ReferenceTraceTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceTypes]...';


GO
ALTER TABLE [Reference].[ReferenceTraceTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceTypes]...';


GO
ALTER TABLE [Reference].[ReferenceTraceTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT (getdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT ((0)) FOR [TypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT ((0)) FOR [EntityTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT (newid()) FOR [ReferenceGuid];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT ('') FOR [AlternateId];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT ('') FOR [Alias];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT ('') FOR [Description];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceObjects]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD DEFAULT ((0)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTypes]...';


GO
ALTER TABLE [Reference].[ReferenceTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTypes]...';


GO
ALTER TABLE [Reference].[ReferenceTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTypes]...';


GO
ALTER TABLE [Reference].[ReferenceTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT ('v1r0') FOR [TemplateVersionId];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT ((20)) FOR [TemplateTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT ((0)) FOR [GroupNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT ((1)) FOR [ScopeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD DEFAULT ((1)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyTypes]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD DEFAULT ((0)) FOR [GroupNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyTypes]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD DEFAULT ((0)) FOR [ValueTypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyTypes]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD DEFAULT ('') FOR [Value];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyTypes]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyTypes]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyTypes]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyGroups]...';


GO
ALTER TABLE [Reference].[ReferencePolicyGroups]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyGroups]...';


GO
ALTER TABLE [Reference].[ReferencePolicyGroups]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicyGroups]...';


GO
ALTER TABLE [Reference].[ReferencePolicyGroups]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditGroup]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroup]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditGroup]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroup]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditGroup]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroup]
    ADD DEFAULT ((1)) FOR [ScopeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditGroup]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroup]
    ADD DEFAULT ((1)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceLog]...';


GO
ALTER TABLE [Reference].[ReferenceTraceLog]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceLog]...';


GO
ALTER TABLE [Reference].[ReferenceTraceLog]
    ADD DEFAULT (getdate()) FOR [TraceDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceLog]...';


GO
ALTER TABLE [Reference].[ReferenceTraceLog]
    ADD DEFAULT ((0)) FOR [TypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceTraceLog]...';


GO
ALTER TABLE [Reference].[ReferenceTraceLog]
    ADD DEFAULT ('COMMONS') FOR [OrganizationId];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('COMMONS') FOR [ReferenceId];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ((1)) FOR [DefaultLanguageNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('US') FOR [DefaultCountryCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultPostalCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultStateCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultRegionCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultRegionText];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultProvinceCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultProvinceText];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultMunicipalityCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultMunicipalityText];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultCityCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('') FOR [DefaultCityText];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceOrganizationPreferences]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD DEFAULT ('41020') FOR [ServiceGlAccountID];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditGroupTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroupTemplate]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDataEditGroupTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroupTemplate]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicies]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicies]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD DEFAULT ((0)) FOR [GroupNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicies]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD DEFAULT ((0)) FOR [TypeNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePolicies]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD DEFAULT ('') FOR [Value];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceList]...';


GO
ALTER TABLE [Reference].[ReferenceList]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceList]...';


GO
ALTER TABLE [Reference].[ReferenceList]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceList]...';


GO
ALTER TABLE [Reference].[ReferenceList]
    ADD DEFAULT ((1)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceList]...';


GO
ALTER TABLE [Reference].[ReferenceList]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDevices]...';


GO
ALTER TABLE [Reference].[ReferenceDevices]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDevices]...';


GO
ALTER TABLE [Reference].[ReferenceDevices]
    ADD DEFAULT ('COMMONS') FOR [OrganizationId];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceDevices]...';


GO
ALTER TABLE [Reference].[ReferenceDevices]
    ADD DEFAULT (getdate()) FOR [LastUpdate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePreference]...';


GO
ALTER TABLE [Reference].[ReferencePreference]
    ADD DEFAULT (getdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferencePreference]...';


GO
ALTER TABLE [Reference].[ReferencePreference]
    ADD DEFAULT ('COMMONS') FOR [OrganizationId];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroupItem]...';


GO
ALTER TABLE [Reference].[ReferenceListGroupItem]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroupItem]...';


GO
ALTER TABLE [Reference].[ReferenceListGroupItem]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroup]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD DEFAULT (getutcdate()) FOR [CreatedDate];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroup]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD DEFAULT ((0)) FOR [SequenceNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroup]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD DEFAULT ((1)) FOR [StatusNo];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroup]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD DEFAULT ('A') FOR [RecordStatusCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [Reference].[ReferenceListGroup]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD DEFAULT (getutcdate()) FOR [LastUpdateDate];


GO
PRINT N'Creating Sequence [Common].[IdBaseCounter]...';


GO
CREATE SEQUENCE [Common].[IdBaseCounter]
    AS INT
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 999999
    CYCLE
    CACHE 15;


GO
PRINT N'Creating Sequence [Common].[IdBaseSessionCounter]...';


GO
CREATE SEQUENCE [Common].[IdBaseSessionCounter]
    AS INT
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 999999
    CYCLE
    CACHE 15;


GO
PRINT N'Creating Sequence [Common].[IdBaseReferenceCounter]...';


GO
CREATE SEQUENCE [Common].[IdBaseReferenceCounter]
    AS INT
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 999999
    CYCLE
    CACHE 15;


GO
PRINT N'Creating Sequence [Common].[IdBaseSubmissionCounter]...';


GO
CREATE SEQUENCE [Common].[IdBaseSubmissionCounter]
    AS INT
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 999999
    CYCLE
    CACHE 15;


GO
PRINT N'Creating Sequence [Common].[IdBasePersonCounter]...';


GO
CREATE SEQUENCE [Common].[IdBasePersonCounter]
    AS INT
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 999999
    CYCLE
    CACHE 15;


GO
PRINT N'Creating Foreign Key [B2B].[fk_ExchangeDefinitionCodeExchangeID]...';


GO
ALTER TABLE [B2B].[ExchangeDefinition]
    ADD CONSTRAINT [fk_ExchangeDefinitionCodeExchangeID] FOREIGN KEY ([ExchangeCode]) REFERENCES [B2B].[ExchangeCode] ([CodeID]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataNoteReference]...';


GO
ALTER TABLE [Data].[DataNote]
    ADD CONSTRAINT [fk_DataNoteReference] FOREIGN KEY ([ReferenceId]) REFERENCES [Data].[DataReferenceObject] ([ReferenceId]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataNoteType]...';


GO
ALTER TABLE [Data].[DataNote]
    ADD CONSTRAINT [fk_DataNoteType] FOREIGN KEY ([NoteTypeNo]) REFERENCES [Data].[DataNoteType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataBatchDomain]...';


GO
ALTER TABLE [Data].[DataBatch]
    ADD CONSTRAINT [fk_DataBatchDomain] FOREIGN KEY ([DomainNo]) REFERENCES [Data].[DataDomain] ([DomainNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataCodeNo]...';


GO
ALTER TABLE [Data].[DataCode]
    ADD CONSTRAINT [fk_DataCodeNo] FOREIGN KEY ([CodeSetNo]) REFERENCES [Data].[DataCodeSet] ([CodeSetNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataCodeSetBatch]...';


GO
ALTER TABLE [Data].[DataCodeSetBatch]
    ADD CONSTRAINT [fk_DataCodeSetBatch] FOREIGN KEY ([CodeSetNo]) REFERENCES [Data].[DataCodeSet] ([CodeSetNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataCodeSetDomain]...';


GO
ALTER TABLE [Data].[DataCodeSet]
    ADD CONSTRAINT [fk_DataCodeSetDomain] FOREIGN KEY ([DomainNo]) REFERENCES [Data].[DataDomain] ([DomainNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataCodeElementCodeSet]...';


GO
ALTER TABLE [Data].[DataCodeElement]
    ADD CONSTRAINT [fk_DataCodeElementCodeSet] FOREIGN KEY ([CodeSetNo]) REFERENCES [Data].[DataCodeSet] ([CodeSetNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataCodeElementNo]...';


GO
ALTER TABLE [Data].[DataCodeElement]
    ADD CONSTRAINT [fk_DataCodeElementNo] FOREIGN KEY ([ElementNo]) REFERENCES [Data].[DataElement] ([ElementNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataAssetGroupType]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD CONSTRAINT [fk_DataAssetGroupType] FOREIGN KEY ([GroupTypeNo]) REFERENCES [Data].[DataAssetGroupType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataGroupStatus]...';


GO
ALTER TABLE [Data].[DataGroup]
    ADD CONSTRAINT [fk_DataGroupStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Object].[ObjectStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataReferenceObjectType]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD CONSTRAINT [fk_DataReferenceObjectType] FOREIGN KEY ([ReferenceTypeNo]) REFERENCES [Data].[DataReferenceType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataReferenceStatus]...';


GO
ALTER TABLE [Data].[DataReferenceObject]
    ADD CONSTRAINT [fk_DataReferenceStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Data].[DataReferenceStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementConstraintType]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementConstraintType] FOREIGN KEY ([ElementConstraintNo]) REFERENCES [Data].[DataConstraintType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementDomain]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementDomain] FOREIGN KEY ([DomainNo]) REFERENCES [Data].[DataDomain] ([DomainNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementElementType]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementElementType] FOREIGN KEY ([ElementTypeNo]) REFERENCES [Data].[DataElementType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementGroupType]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementGroupType] FOREIGN KEY ([ElementGroupNo]) REFERENCES [Data].[DataGroupType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementKeyType]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementKeyType] FOREIGN KEY ([ElementKeyTypeNo]) REFERENCES [Data].[DataKeyType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementKind]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementKind] FOREIGN KEY ([KindNo]) REFERENCES [Data].[DataKind] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementStatus]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Data].[DataReferenceStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataElementValueType]...';


GO
ALTER TABLE [Data].[DataElement]
    ADD CONSTRAINT [fk_DataElementValueType] FOREIGN KEY ([ValueTypeNo]) REFERENCES [Object].[ObjectValueTypes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataTermDomainUri]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD CONSTRAINT [fk_DataTermDomainUri] FOREIGN KEY ([DomainNo]) REFERENCES [Data].[DataDomain] ([DomainNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataTermEntity]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD CONSTRAINT [fk_DataTermEntity] FOREIGN KEY ([OrganizationId], [DataOwnerId]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataTermStatus]...';


GO
ALTER TABLE [Data].[DataTerm]
    ADD CONSTRAINT [fk_DataTermStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Data].[DataReferenceStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Data].[fk_DataDomainType]...';


GO
ALTER TABLE [Data].[DataDomain]
    ADD CONSTRAINT [fk_DataDomainType] FOREIGN KEY ([TypeNo]) REFERENCES [Data].[DataDomainType] ([IdNo]);


GO
PRINT N'Creating Foreign Key [IdBase].[fk_ibte01]...';


GO
ALTER TABLE [IdBase].[IdBaseTypeExtensions]
    ADD CONSTRAINT [fk_ibte01] FOREIGN KEY ([TypeNo]) REFERENCES [IdBase].[IdBaseTypes] ([TypeNo]);


GO
PRINT N'Creating Foreign Key [IdBase].[fk_ibte02]...';


GO
ALTER TABLE [IdBase].[IdBaseTypeExtensions]
    ADD CONSTRAINT [fk_ibte02] FOREIGN KEY ([ExtensionNo]) REFERENCES [IdBase].[IdBaseExtensions] ([ExtensionNo]);


GO
PRINT N'Creating Foreign Key [IdBase].[fk_ibgm00]...';


GO
ALTER TABLE [IdBase].[IdBaseGroupMembers]
    ADD CONSTRAINT [fk_ibgm00] FOREIGN KEY ([GroupNo]) REFERENCES [IdBase].[IdBaseGroups] ([IdNo]);


GO
PRINT N'Creating Foreign Key [IdBase].[fk_ibgm01]...';


GO
ALTER TABLE [IdBase].[IdBaseGroupMembers]
    ADD CONSTRAINT [fk_ibgm01] FOREIGN KEY ([TypeNo]) REFERENCES [IdBase].[IdBaseTypes] ([TypeNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceTypesGroupMemberIdNo]...';


GO
ALTER TABLE [Reference].[ReferenceTypesGroupMembers]
    ADD CONSTRAINT [fk_ReferenceTypesGroupMemberIdNo] FOREIGN KEY ([IdNo]) REFERENCES [Reference].[ReferenceTypesGroups] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceTypesGroupMemberTypeNo]...';


GO
ALTER TABLE [Reference].[ReferenceTypesGroupMembers]
    ADD CONSTRAINT [fk_ReferenceTypesGroupMemberTypeNo] FOREIGN KEY ([TypeNo]) REFERENCES [Reference].[ReferenceBaseTypes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceObjectStatus]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD CONSTRAINT [fk_ReferenceObjectStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Object].[ObjectStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceObjectTypeNo]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD CONSTRAINT [fk_ReferenceObjectTypeNo] FOREIGN KEY ([TypeNo]) REFERENCES [Reference].[ReferenceTypes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceObjectTypeNoEntityTypeNo]...';


GO
ALTER TABLE [Reference].[ReferenceObjects]
    ADD CONSTRAINT [fk_ReferenceObjectTypeNoEntityTypeNo] FOREIGN KEY ([EntityTypeNo]) REFERENCES [Reference].[ReferenceBaseTypes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditTemplateGroup]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD CONSTRAINT [fk_ReferenceDataEditTemplateGroup] FOREIGN KEY ([GroupNo]) REFERENCES [Reference].[ReferenceDataEditGroup] ([GroupNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditTemplateScope]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD CONSTRAINT [fk_ReferenceDataEditTemplateScope] FOREIGN KEY ([ScopeNo]) REFERENCES [Object].[ObjectScopes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditTemplateStatus]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditTemplate]
    ADD CONSTRAINT [fk_ReferenceDataEditTemplateStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Object].[ObjectStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferencePolicyTypeGroup]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD CONSTRAINT [fk_ReferencePolicyTypeGroup] FOREIGN KEY ([GroupNo]) REFERENCES [Reference].[ReferencePolicyGroups] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferencePolicyTypeValueType]...';


GO
ALTER TABLE [Reference].[ReferencePolicyTypes]
    ADD CONSTRAINT [fk_ReferencePolicyTypeValueType] FOREIGN KEY ([ValueTypeNo]) REFERENCES [Object].[ObjectValueTypes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditGroupScope]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroup]
    ADD CONSTRAINT [fk_ReferenceDataEditGroupScope] FOREIGN KEY ([ScopeNo]) REFERENCES [Object].[ObjectScopes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditGroupStatus]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroup]
    ADD CONSTRAINT [fk_ReferenceDataEditGroupStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Object].[ObjectStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceTraceLog]...';


GO
ALTER TABLE [Reference].[ReferenceTraceLog]
    ADD CONSTRAINT [fk_ReferenceTraceLog] FOREIGN KEY ([OrganizationId], [ReferenceId]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceTraceLogType]...';


GO
ALTER TABLE [Reference].[ReferenceTraceLog]
    ADD CONSTRAINT [fk_ReferenceTraceLogType] FOREIGN KEY ([TypeNo]) REFERENCES [Reference].[ReferenceTraceTypes] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceOrganizationPreferenceEntityId]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD CONSTRAINT [fk_ReferenceOrganizationPreferenceEntityId] FOREIGN KEY ([OrganizationId], [CreatedBy]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceOrganizationPreferenceOrganization]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD CONSTRAINT [fk_ReferenceOrganizationPreferenceOrganization] FOREIGN KEY ([OrganizationId], [ReferenceId]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceOrganizationPreferencesLanguage]...';


GO
ALTER TABLE [Reference].[ReferenceOrganizationPreferences]
    ADD CONSTRAINT [fk_ReferenceOrganizationPreferencesLanguage] FOREIGN KEY ([DefaultLanguageNo]) REFERENCES [Object].[ObjectLanguages] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditGroup]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroupTemplate]
    ADD CONSTRAINT [fk_ReferenceDataEditGroup] FOREIGN KEY ([GroupNo]) REFERENCES [Reference].[ReferenceDataEditGroup] ([GroupNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditGroupOrganization]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroupTemplate]
    ADD CONSTRAINT [fk_ReferenceDataEditGroupOrganization] FOREIGN KEY ([OrganizationId], [ReferenceId]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDataEditTemplate]...';


GO
ALTER TABLE [Reference].[ReferenceDataEditGroupTemplate]
    ADD CONSTRAINT [fk_ReferenceDataEditTemplate] FOREIGN KEY ([TemplateNo]) REFERENCES [Reference].[ReferenceDataEditTemplate] ([TemplateNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferencePoliciesGroup]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD CONSTRAINT [fk_ReferencePoliciesGroup] FOREIGN KEY ([GroupNo]) REFERENCES [Reference].[ReferencePolicyGroups] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferencePoliciesReference]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD CONSTRAINT [fk_ReferencePoliciesReference] FOREIGN KEY ([OrganizationId], [ReferenceId]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferencePoliciesType]...';


GO
ALTER TABLE [Reference].[ReferencePolicies]
    ADD CONSTRAINT [fk_ReferencePoliciesType] FOREIGN KEY ([TypeNo], [GroupNo]) REFERENCES [Reference].[ReferencePolicyTypes] ([IdNo], [GroupNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceListStatus]...';


GO
ALTER TABLE [Reference].[ReferenceList]
    ADD CONSTRAINT [fk_ReferenceListStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Object].[ObjectStatus] ([IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceDevicesReference]...';


GO
ALTER TABLE [Reference].[ReferenceDevices]
    ADD CONSTRAINT [fk_ReferenceDevicesReference] FOREIGN KEY ([OrganizationId], [ReferenceId]) REFERENCES [Reference].[ReferenceObjects] ([OrganizationId], [ReferenceId]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceListGroupItemGroup]...';


GO
ALTER TABLE [Reference].[ReferenceListGroupItem]
    ADD CONSTRAINT [fk_ReferenceListGroupItemGroup] FOREIGN KEY ([OrganizationId], [GroupNo], [ListNo]) REFERENCES [Reference].[ReferenceListGroup] ([OrganizationId], [GroupNo], [ListNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceListGroupNo]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD CONSTRAINT [fk_ReferenceListGroupNo] FOREIGN KEY ([OrganizationId], [GroupNo]) REFERENCES [Reference].[ReferenceList] ([OrganizationId], [IdNo]);


GO
PRINT N'Creating Foreign Key [Reference].[fk_ReferenceListGroupStatus]...';


GO
ALTER TABLE [Reference].[ReferenceListGroup]
    ADD CONSTRAINT [fk_ReferenceListGroupStatus] FOREIGN KEY ([StatusNo]) REFERENCES [Object].[ObjectStatus] ([IdNo]);


GO
PRINT N'Creating Function [Common].[IdBaseGetNewPrefixedYmdhmSequence]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- DROP FUNCTION [Common].[IdBaseGetNewPrefixedYmdhmSequence]
CREATE FUNCTION [Common].[IdBaseGetNewPrefixedYmdhmSequence] (
   @PrefixId       VARCHAR(2),   -- prefix (e.g. SB for submission)
   @SequenceNo     INTEGER)
RETURNS VARCHAR(20)
AS
BEGIN
   DECLARE @OutId VARCHAR(20)
   SET @OutId = NULL

   -- current running year and other needed info
   DECLARE @ct         DATETIME2,
           @currYear   VARCHAR(4),
           @currMonth  CHAR(2),
           @currDay    CHAR(2),
           @currHour   CHAR(2),
           @currMins   CHAR(2),
           @currCount  INTEGER

   SET @ct       = getutcdate()
   SET @currYear = cast(year(@ct) as char(4))
   SET @currMonth= substring(cast(month(@ct) as char(2)),1,2)
   SET @currDay  = substring(cast(day(@ct) as char(2)),1,2)
   SET @currHour = substring(cast(datepart(hh,@ct) as char(2)),1,2)
   SET @currMins = substring(cast(datepart(mi,@ct) as char(2)),1,2)

   SET @currYear = substring(@currYear,3,2)

   IF len(@currMonth) = 1
      SET @currMonth = '0' + @currMonth
   IF len(@currDay) = 1
      SET @currDay = '0' + @currDay
   IF len(@currHour) = 1
      SET @currHour = '0' + @currHour
   IF len(@currMins) = 1
      SET @currMins = '0' + @currMins

   --IF @SequenceNo < 0
   --   SET @SequenceNo = next value for Common.IdBaseCounter
   SET @currCount = @SequenceNo

   -- finally build the new State Id
   DECLARE @new VARCHAR(10)

   SET @new = rtrim(cast(@currCount as varchar(6)))
   SET @new = replicate('0',6-len(@new))+@new
   SET @OutId = @PrefixId + @currYear + @currMonth + @currDay +
      @currHour + @currMins + @new
   RETURN @OutId
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Function [Helper].[HelperDateTimePatternParse]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- D 68 100
-- H 72 104
-- M 77 109
-- S 83 115
-- Y 89 121
-- N 78 110

CREATE FUNCTION Helper.HelperDateTimePatternParse(
   @LanguageNo SMALLINT,
   @Date1      DATETIME,
   @Date2      DATETIME,
   @Template   VARCHAR(1024))
RETURNS VARCHAR(1024)
AS
BEGIN
   DECLARE @i1 INTEGER, @i2 INTEGER, @i3 INTEGER, @c INTEGER, @l INTEGER
   DECLARE @p  CHAR(1), @s CHAR(1)

   DECLARE @r  VARCHAR(1024), @t  VARCHAR(80)
   DECLARE @p1 VARCHAR(10),   @p2 VARCHAR(10)
   DECLARE @p3 VARCHAR(10),   @p4 VARCHAR(10)
   DECLARE @k  VARCHAR(1024), @kk CHAR(1)

   SET @r = @Template

   SET @l = len(@Template)
   IF @l <= 0
      RETURN @Template

   SET @c = 1
   WHILE (@c > 0)
   BEGIN
      SET @l  = len(@r)
      SET @i1 = patindex('%&&%',@r)
      IF @i1 = 0
         RETURN @r

      -- parsing a Date? (D1 or D2)
      IF substring(@r,@i1+2,1) = 'D'
      BEGIN
         IF substring(@r,@i1+3,1) = '1'
            SET @t = convert(CHAR(10),@Date1,101)
         ELSE
            SET @t = convert(CHAR(10),@Date2,101)

         SET @p1 = substring(@t,1,2) -- month
         SET @p2 = substring(@t,4,2) -- day
         SET @p3 = substring(@t,7,4) -- year
         SET @p4 = ''
         SET @p  = 'D'

         IF substring(@r,@i1+4,1) not in ('M','D','Y','N','&')
         BEGIN
            SET @s  = substring(@r,@i1+4,1)
            SET @i2 = @i1+5
            SET @i3 = 5
            SET @l  = @l - @i1+5
         END
         ELSE
         BEGIN
            SET @s  = '/'
            SET @i2 = @i1+4
            SET @i3 = 4
            SET @l  = @l - @i1+4
         END

         -- for each date part prepare resulting string in @k

         SET @k  = substring(@r,@i2,@l)
         SET @kk = substring(@k,1,1)
         SET @c  = 1
         SET @t  = ''

         WHILE @kk <> '&'
         BEGIN
            IF @t <> ''
               SET @t = @t + @s

            IF ascii(@kk) = 77  -- M 77
               SET @t = @t + @p1
            ELSE
            IF ascii(@kk) = 109 -- m 109
               SET @t = @t + cast(cast(@p1 as int) as varchar)
            ELSE
            IF ascii(@kk) = 68  -- D 68
               SET @t = @t + @p2
            ELSE
            IF ascii(@kk) = 100 -- d 100
               SET @t = @t + cast(cast(@p2 as int) as varchar)
            ELSE
            IF ascii(@kk) = 89  -- Y 89
               SET @t = @t + @p3
            ELSE
            IF ascii(@kk) = 121 -- y 121
               SET @t = @t + substring(@p3,3,2) + ' '
            ELSE
            IF ascii(@kk) = 78  -- N 78
            BEGIN
               IF @LanguageNo = 0
               BEGIN
                  IF cast(@p1 as int) = 1
                     SET @t = @t + 'Enero'
                  IF cast(@p1 as int) = 2
                     SET @t = @t + 'Febrero'
                  IF cast(@p1 as int) = 3
                     SET @t = @t + 'Marzo'
                  IF cast(@p1 as int) = 4
                     SET @t = @t + 'Abril'
                  IF cast(@p1 as int) = 5
                     SET @t = @t + 'Mayo'
                  IF cast(@p1 as int) = 6
                     SET @t = @t + 'Junio'
                  IF cast(@p1 as int) = 7
                     SET @t = @t + 'Julio'
                  IF cast(@p1 as int) = 8
                     SET @t = @t + 'Agosto'
                  IF cast(@p1 as int) = 9
                     SET @t = @t + 'Septiembre'
                  IF cast(@p1 as int) = 10
                     SET @t = @t + 'Octubre'
                  IF cast(@p1 as int) = 11
                     SET @t = @t + 'Noviembre'
                  IF cast(@p1 as int) = 12
                     SET @t = @t + 'Diciembre'
               END
               ELSE
               BEGIN
                  IF cast(@p1 as int) = 1
                     SET @t = @t + 'January'
                  IF cast(@p1 as int) = 2
                     SET @t = @t + 'February'
                  IF cast(@p1 as int) = 3
                     SET @t = @t + 'March'
                  IF cast(@p1 as int) = 4
                     SET @t = @t + 'April'
                  IF cast(@p1 as int) = 5
                     SET @t = @t + 'May'
                  IF cast(@p1 as int) = 6
                     SET @t = @t + 'June'
                  IF cast(@p1 as int) = 7
                     SET @t = @t + 'July'
                  IF cast(@p1 as int) = 8
                     SET @t = @t + 'August'
                  IF cast(@p1 as int) = 9
                     SET @t = @t + 'September'
                  IF cast(@p1 as int) = 10
                     SET @t = @t + 'Octuber'
                  IF cast(@p1 as int) = 11
                     SET @t = @t + 'November'
                  IF cast(@p1 as int) = 12
                     SET @t = @t + 'December'
               END
            END
            ELSE
            IF ascii(@kk) = 110 -- n 110
            BEGIN
               IF @LanguageNo = 0
               BEGIN
                  IF cast(@p1 as int) = 1
                     SET @t = @t + 'Ene'
                  IF cast(@p1 as int) = 2
                     SET @t = @t + 'Feb'
                  IF cast(@p1 as int) = 3
                     SET @t = @t + 'Mar'
                  IF cast(@p1 as int) = 4
                     SET @t = @t + 'Abr'
                  IF cast(@p1 as int) = 5
                     SET @t = @t + 'May'
                  IF cast(@p1 as int) = 6
                     SET @t = @t + 'Jun'
                  IF cast(@p1 as int) = 7
                     SET @t = @t + 'Jul'
                  IF cast(@p1 as int) = 8
                     SET @t = @t + 'Ago'
                  IF cast(@p1 as int) = 9
                     SET @t = @t + 'Sep'
                  IF cast(@p1 as int) = 10
                     SET @t = @t + 'Oct'
                  IF cast(@p1 as int) = 11
                     SET @t = @t + 'Nov'
                  IF cast(@p1 as int) = 12
                     SET @t = @t + 'Dic'
               END
               ELSE
               BEGIN
                  IF cast(@p1 as int) = 1
                     SET @t = @t + 'Jan'
                  IF cast(@p1 as int) = 2
                     SET @t = @t + 'Feb'
                  IF cast(@p1 as int) = 3
                     SET @t = @t + 'Mar'
                  IF cast(@p1 as int) = 4
                     SET @t = @t + 'Apr'
                  IF cast(@p1 as int) = 5
                     SET @t = @t + 'May'
                  IF cast(@p1 as int) = 6
                     SET @t = @t + 'Jun'
                  IF cast(@p1 as int) = 7
                     SET @t = @t + 'Jul'
                  IF cast(@p1 as int) = 8
                     SET @t = @t + 'Aug'
                  IF cast(@p1 as int) = 9
                     SET @t = @t + 'Sep'
                  IF cast(@p1 as int) = 10
                     SET @t = @t + 'Oct'
                  IF cast(@p1 as int) = 11
                     SET @t = @t + 'Nov'
                  IF cast(@p1 as int) = 12
                     SET @t = @t + 'Dec'
               END
            END

            SET @i2 = @i2 + 1
            SET @c  = @c  + 1
            SET @kk = substring(@k,@c,1)
         END
         SET @r = substring(@r,1,@i1-1) + @t +
                  substring(@r,@i2+1,len(@r)-@i2+1)
      END

      -- parsing a Time? (T1 or T2)
      ELSE
      IF substring(@r,@i1+2,1) = 'T'
      BEGIN
         IF substring(@r,@i1+3,1) = '1'
            SET @t = convert(CHAR(12),@Date1,114)
         ELSE
            SET @t = convert(CHAR(12),@Date2,114)

         SET @p1 = substring(@t,1,2)  -- hour
         SET @p2 = substring(@t,4,2)  -- minutes
         SET @p3 = substring(@t,7,2)  -- seconds
         SET @p4 = substring(@t,10,3) -- milliseconds
         SET @p  = 'T'

         IF substring(@r,@i1+4,1) not in ('H','M','S','&')
         BEGIN
            SET @s  = substring(@r,@i1+4,1)
            SET @i2 = @i1+5
            SET @i3 = 5
            SET @l  = @l - @i1+5
         END
         ELSE
         BEGIN
            SET @s  = ':'
            SET @i2 = @i1+4
            SET @i3 = 4
            SET @l  = @l - @i1+4
         END

         -- for each date part prepare resulting string in @k

         -- for each date part prepare resulting string in @k

         SET @k  = substring(@r,@i2,@l)
         SET @kk = substring(@k,1,1)
         SET @c  = 1
         SET @t  = ''

         WHILE @kk <> '&'
         BEGIN
            IF @t <> ''
               SET @t = @t + @s

            IF ascii(@kk) = 72  -- H 72
               SET @t = @t + @p1
            ELSE
            IF ascii(@kk) = 104 -- h 104
               SET @t = @t + cast(cast(@p1 as int) as varchar)
            ELSE
            IF ascii(@kk) = 77  -- M 77
               SET @t = @t + @p2
            ELSE
            IF ascii(@kk) = 109 -- m 109
               SET @t = @t + cast(cast(@p2 as int) as varchar)
            ELSE
            IF ascii(@kk) = 83  -- S 83
               SET @t = @t + @p3
            ELSE
            IF ascii(@kk) = 115 -- s 115
               SET @t = @t + cast(cast(@p3 as int) as varchar)

            SET @i2 = @i2 + 1
            SET @c  = @c  + 1
            SET @kk = substring(@k,@c,1)
         END
         SET @r = substring(@r,1,@i1-1) + @t +
                  substring(@r,@i2+1,len(@r)-@i2+1)
      END
      ELSE
         BREAK
   END

   RETURN @r
END  -- end of DateTimePatternParse
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Function [Helper].[HelperGetLanguageNo]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE FUNCTION Helper.HelperGetLanguageNo(
   @Language VARCHAR(40))
RETURNS SMALLINT
AS
BEGIN
   DECLARE @langNo SMALLINT
   SET @Language = lower(@Language)
   IF @Language = 'spa' or @Language = 'esp' or @Language = 'es-PR' or
      @Language = 'es' or @Language = 'español'
      SET @langNo = 0
   ELSE
      SET @langNo = 1
   RETURN @langNo
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Function [IdBase].[IdBaseGroupMembersList]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE FUNCTION IdBase.IdBaseGroupMembersList (
   @LanguageNo SMALLINT)
RETURNS TABLE
AS
RETURN
(
   SELECT m.GroupNo,
          GroupDescription =
             case @LanguageNo when 0
             then g.SpanishDescription
             else g.Description end,
          m.TypeNo,
          TypeDescription =
             case @LanguageNo when 0
             then t.SpanishDescription
             else t.Description end,
          t.Length,
          t.Template,
          t.Required,
          isnull(t.TableName,'') TableName,
          t.TypeName
     FROM IdBase.IdBaseGroupMembers m
     JOIN IdBase.IdBaseGroups g
       ON m.GroupNo = g.IdNo
     JOIN IdBase.IdBaseTypes t
       ON t.TypeNo = m.TypeNo
)
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [B2B].[ExchangeCodeInsertUpdate]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE [B2B].[ExchangeCodeInsertUpdate]
   @SessionId   VARCHAR(40),
   @DataOwnerId VARCHAR(20),
   @CodeId      VARCHAR(20),
   @Description VARCHAR(128)
AS
BEGIN
   SET NOCOUNT ON
   IF NOT EXISTS(SELECT * FROM B2B.ExchangeCode
                  WHERE CodeId = @CodeId)
   BEGIN
      INSERT INTO B2B.ExchangeCode (CodeId, Description, DataOwnerId, UpdateSessionId)
      SELECT @CodeID, @Description, @DataOwnerId, @SessionId
   END
   ELSE
   BEGIN
      UPDATE B2B.ExchangeCode
         SET Description = @Description
       WHERE CodeId = @CodeId
         AND DataOwnerId = @DataOwnerId
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [B2B].[ExchangeDefinitionInsertUpdate]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE [B2B].[ExchangeDefinitionInsertUpdate]
   @SessionId               VARCHAR(40),
   @DataOwnerId             VARCHAR(20) = '',
   @ItemNo                  INT,
   @ExchangeCode            VARCHAR(40) = '',
   @SegmentName             VARCHAR(128) = '',
   @BaseEntityName          VARCHAR(128) = '',
   @SegmentEntityName       VARCHAR(128) = '',
   @Position                VARCHAR(20) = '',
   @SegmentCode             VARCHAR(20) = '',
   @SegmentRepeat           VARCHAR(20) = '',
   @SegmentRequiredType     VARCHAR(20) = '',
   @SegmentReference        VARCHAR(20) = '',
   @DataElementId           VARCHAR(20) = '',
   @DataElementType         VARCHAR(20) = '',
   @DataElement             VARCHAR(128) = '',
   @DataElementDescription  VARCHAR(512) = '',
   @DataElementRequiredType VARCHAR(20) = '',
   @DataType                VARCHAR(20) = '',
   @MinimumLength           SMALLINT = null,
   @MaximumLength           SMALLINT = null,
   @Loop                    VARCHAR(20) = '',
   @LoopLevel               SMALLINT = null,
   @VersionID               VARCHAR(40) = '',
   @OutItemNo               INT OUTPUT
AS
BEGIN
   SET NOCOUNT ON

   IF @ItemNo is null or @ItemNo < 1
   BEGIN
      SELECT @ItemNo = ItemNo
        FROM B2B.ExchangeDefinition
       WHERE ExchangeCode = @ExchangeCode
         AND SegmentCode = @SegmentCode
         AND SegmentReference = @SegmentReference
         AND SegmentEntityName = @SegmentEntityName
         AND DataElementId = @DataElementId
   END

   IF NOT EXISTS (SELECT * FROM B2B.ExchangeDefinition
                   WHERE @ItemNo is not null
                     AND ItemNo = @ItemNo)
   BEGIN
      INSERT INTO B2B.ExchangeDefinition (
          ExchangeCode,      SegmentName,             SegmentEntityName,
          SegmentCode,       SegmentRepeat,           SegmentRequiredType,
          SegmentReference,  DataElementID,           DataElementType,
          DataElement,       DataElementDescription,  DataElementRequiredType,
          MinimumLength,     MaximumLength,           DataType,
          UpdateSessionID,   DataOwnerId,             BaseEntityName,
          Position,          Loop,                    LoopLevel,
          VersionID
      ) VALUES (
         @ExchangeCode,     @SegmentName,            @SegmentEntityName,
         @SegmentCode,      @SegmentRepeat,          @SegmentRequiredType,
         @SegmentReference, @DataElementID,          @DataElementType,
         @DataElement,      @DataElementDescription, @DataElementRequiredType,
         @MinimumLength,    @MaximumLength,          @DataType,
         @SessionId,        @DataOwnerId,            @BaseEntityName,
         @Position,         @Loop,                   @LoopLevel,
         @VersionID)
      SET @OutItemNo = @@IDENTITY
   END
   ELSE
   BEGIN
      UPDATE B2B.ExchangeDefinition
         SET UpdateSessionID = @SessionID,
             LastUpdateDateTime = getutcdate(),
             ExchangeCode = @ExchangeCode,
             SegmentName = @SegmentName,
             BaseEntityName = @BaseEntityName,
             SegmentEntityName = @SegmentEntityName,
             Position = @Position,
             SegmentCode = @SegmentCode,
             SegmentRepeat = @SegmentRepeat,
             SegmentRequiredType = @SegmentRequiredType,
             SegmentReference = @SegmentReference,
             DataElementID = @DataElementID,
             DataElementType = @DataElementType,
             DataElement = @DataElement,
             DataElementDescription = @DataElementDescription,
             DataElementRequiredType = DataElementRequiredType,
             MinimumLength = @MinimumLength,
             MaximumLength = @MaximumLength,
             DataType = @DataType,
             Loop = @Loop,
             LoopLevel = @LoopLevel,
             VersionID = @VersionID
       WHERE ItemNo = @ItemNo
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataBatchUpsert]...';


GO

CREATE PROCEDURE Data.DataBatchUpsert
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @DataOwnerId      VARCHAR(20),
   @BatchId          VARCHAR(40) = NULL,
   @DomainUri        VARCHAR(2048),
   @VersionId        VARCHAR(20) = NULL,
   @GroupId          VARCHAR(20) = NULL,
   @OutBatchId       VARCHAR(40) OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON

   DECLARE @dno INTEGER,
           @sno INTEGER,
           @bid VARCHAR(40)

   SELECT @dno = DomainNo
     FROM Data.DataDomain
    WHERE DomainURI = @DomainUri
   IF @dno is null
      RETURN -1

   SELECT @sno = max(BatchNo)
     FROM Data.DataBatch
    WHERE DomainNo = @dno
      AND GroupId = @GroupId
    GROUP BY DomainNo
   SET @sno = @sno + 1

   IF NOT EXISTS(SELECT * FROM Data.DataBatch
                  WHERE BatchId = @BatchId)
   BEGIN
      SET @OutBatchId = cast(newid() as varchar(40))
      INSERT INTO Data.DataBatch (
         BatchId, DomainNo, GroupId, SequenceNo, VersionId, UpdateSessionId,
         OrganizationId, DataOwnerId)
      VALUES (
         @OutBatchId, @dno, @GroupId, @sno, @VersionId, @SessionId,
         @OrganizationId, @DataOwnerId)
   END
   ELSE
   BEGIN
      SET @OutBatchId = @BatchId
      UPDATE Data.DataBatch
         SET LastUpdateDate = getutcdate(),
             RecordStatusCode = 'C'
       WHERE BatchId = @BatchId
   END
END
GO
PRINT N'Creating Procedure [Data].[DataCodeGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataCodeGet
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @CodeSetNo        BIGINT,
   @OptionNo         INT = 1
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   SELECT OrganizationId,
          CodeSetNo,
          IdNo,
          CodeId,
          AlternateId,
          VersionId,
          Description,
          CategoryId,
          DataOwnerId,
          RecordStatusCode
     FROM Data.DataCode
    WHERE OrganizationId = @OrganizationId
      AND CodeSetNo = @CodeSetNo
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataCodeSetUpsert]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataCodeSetUpsert
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @DomainNo         INTEGER,
   @CodeSetUri       VARCHAR(2048),
   @CodeSetNo        BIGINT,
   @CodeSetId        VARCHAR(20),
   @CodeSetName      VARCHAR(128),
   @VersionId        VARCHAR(20),
   @DataOwnerId      VARCHAR(20),
   @OutCodeSetNo     BIGINT OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
   IF NOT EXISTS(SELECT * FROM Data.DataCodeSet WHERE CodeSetNo = @CodeSetNo)
   BEGIN
      INSERT INTO Data.DataCodeSet (
         OrganizationId,   DomainNo,         CodeSetNo,
         CodeSetUri,       CodeSetName,      VersionId,
         DataOwnerId,      UpdateSessionId,  CodeSetId)
      VALUES (
         @OrganizationId, @DomainNo,        @CodeSetNo,
         @CodeSetUri,     @CodeSetName,     @VersionId,
         @DataOwnerId,    @SessionId,       @CodeSetId)
      SET @OutCodeSetNo = @@IDENTITY
   END
   ELSE
   BEGIN
      UPDATE Data.DataCodeSet
         SET CodeSetUri = @CodeSetUri,
             CodeSetName = @CodeSetName,
             CodeSetId = @CodeSetId,
             VersionId = @VersionId,
             UpdateSessionId = @SessionId
       WHERE OrganizationId = @OrganizationId
         AND CodeSetNo = @CodeSetNo
         AND DomainNo = @DomainNo
      SET @OutCodeSetNo = @CodeSetNo
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataCodeSetGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataCodeSetGet
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @CodeSetUri       VARCHAR(2048),
   @OptionNo         INT = 1
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   SELECT OrganizationId,
          DomainNo,
          CodeSetNo,
          CodeSetUri,
          CodeSetName,
          VersionId,
          DataOwnerId,
          RecordStatusCode
     FROM Data.DataCodeSet
    WHERE OrganizationId = @OrganizationId
      AND (@OptionNo = 1
       OR  CodeSetUri like '%' + @CodeSetUri + '%')
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataReferenceObjectNew]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataReferenceObjectNew
   @SessionId       VARCHAR(40) = NULL,
   @ReferenceId     VARCHAR(20) = NULL, -- if null, create it here
   @ReferenceDate   DATETIME2 = NULL,
   @ReferenceTypeNo SMALLINT = NULL,
   @AliasId         VARCHAR(20) = NULL,
   @AlternateId     VARCHAR(40) = NULL,
   @Description     VARCHAR(1024) = NULL,
   @StatusNo        SMALLINT = NULL,
   @OutReferenceId  VARCHAR(20) OUTPUT
AS
BEGIN
   SET NOCOUNT ON
   IF @ReferenceDate is null
      SET @ReferenceDate = getutcdate()
   IF @ReferenceTypeNo is null
      SET @ReferenceTypeNo = 0
   IF @StatusNo is null
      SET @StatusNo = 0
   IF @ReferenceId = ''
			   SET @ReferenceId = null
						
   IF @ReferenceId is null
      SET @OutReferenceId = (
         [Common].[IdBaseGetNewPrefixedYmdhmSequence]('RF',
            next value for Common.IdBaseReferenceCounter))
   ELSE
      SET @OutReferenceId = @ReferenceId

   INSERT INTO Data.DataReferenceObject
      ( ReferenceDate,    ReferenceTypeNo,
        AlternateId,      Description,
        StatusNo,         UpdateSessionId,
        ReferenceId,      AliasId)
   VALUES
      (@ReferenceDate,   @ReferenceTypeNo,
       @AlternateId,     @Description,
       @StatusNo,        @SessionId,
       @OutReferenceId,  @AliasId)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataReferenceElementGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataReferenceElementGet
   @SessionId       VARCHAR(40) = NULL,
   @OrganizationId  VARCHAR(20),
   @Root            VARCHAR(1024),
   @DomainUri       VARCHAR(2048)
AS
BEGIN
   SET NOCOUNT ON
   
   IF @Root is null
      SET @Root = ''
   IF @DomainUri is null
      SET @DomainUri = ''

   SELECT e.CreatedDate,
          e.LastUpdateDate,
          e.ReferenceDate,
          e.OrganizationId,
          e.DataOwnerId,
          e.ExpiredDate,
          e.AssetNo,
          e.Root,
          e.Domain,
          e.Type,
          e.Element,
          e.ElementNo,
          e.ParentNo,
          e.ElementId,
          e.TypeNo,
          e.ElementURI,
          e.ElementName,
          e.ElementType,
          e.ElementDataType,
          e.ElementPath,
          e.Description,
          e.ElementSequenceID,
          e.ElementTypeNo,
          e.ElementGroupNo,
          e.ElementConstraintNo,
          e.ElementKeyTypeNo,
          e.AutoGeneratedTypeNo,
          e.StatusNo,
          e.ValueTypeNo,
          e.MinLength,
          e.MaxLength,
          e.MinOccurrence,
          e.MaxOccurrence,
          e.Nillable,
          e.DefaultValue,
          e.FixedValue,
          e.SampleValue,
          e.PropertiesBagText,
          e.ProcessInstructionsBagText,
          e.SchemaText,
          e.OrdinalNo,
          e.SequenceId,
          e.VersionId,
          e.BatchId,
          e.UpdateSessionId,
          e.RecordStatusCode,
          e.ConstraintsText,
          e.KindNo,
          e.Tags
     FROM Data.DataElement e
     JOIN Data.DataDomain d
       ON e.DomainNo = d.DomainNo
    WHERE e.OrganizationId = @OrganizationId
      AND (@Root = ''
       OR  e.Root = @Root)
      AND (@DomainUri = ''
       OR  d.DomainUri like '%' + @DomainUri + '%')
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataReferenceTermGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataReferenceTermGet
   @SessionId       VARCHAR(40) = NULL,
   @OrganizationId  VARCHAR(20),
   @Root            VARCHAR(1024),
   @DomainUri       VARCHAR(2048),
   @TermName        VARCHAR(1024)
AS
BEGIN
   SET NOCOUNT ON
   
   IF @Root is null
      SET @Root = ''
   IF @DomainUri is null
      SET @DomainUri = ''
   IF @TermName is null
      SET @TermName = ''

   SELECT t.CreatedDate,
          t.LastUpdateDate,
          t.ReferenceDate,
          t.OrganizationId,
          t.DataOwnerId,
          t.ExpiredDate,
          t.DomainNo,
          t.Root,
          t.Domain,
          t.Type,
          t.Element,
          t.TermNo,
          t.TermId,
          t.TermURI,
          t.TermName,
          t.Description,
          t.ConfidenceScore,
          t.StatusNo,
          t.UpdateSessionID,
          t.RecordStatusCode
     FROM Data.DataTerm t
     JOIN Data.DataDomain d
       ON t.DomainNo = d.DomainNo
    WHERE t.OrganizationId = @OrganizationId
      AND (@Root = ''
       OR  t.Root = @Root)
      AND (@DomainUri = ''
       OR   DomainUri like '%' + @DomainUri + '%')
      AND (@TermName = ''
       OR  t.TermName = @TermName)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataReferenceDomainGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataReferenceDomainGet
   @SessionId       VARCHAR(40) = NULL,
   @OrganizationId  VARCHAR(20),
   @Root            VARCHAR(1024) = '',
   @DomainUri       VARCHAR(2048),
   @OptionNo        SMALLINT = 0 
AS
BEGIN
   SET NOCOUNT ON
   
   IF @Root is null
      SET @Root = ''
   IF @DomainUri is null
      SET @DomainUri = ''

   SELECT CreatedDate,
          LastUpdateDate,
          OrganizationId,
          DataOwnerId,
          Prefix,
          Root,
          TypeNo,
          Domain,
          DomainNo,
          DomainID,
          DomainURI,
          DomainName,
          Description,
          UpdateSessionID,
          RecordStatusCode
     FROM Data.DataDomain
    WHERE OrganizationId = @OrganizationId
      AND (@Root = ''
       OR  Root = @Root)
      AND (@DomainUri = ''
       OR   DomainUri like '%' + @DomainUri + '%')
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataCodeUpsert]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataCodeUpsert
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @CodeSetNo        BIGINT,
   @IdNo             BIGINT,
   @CodeId           VARCHAR(40),
   @AlternateId      VARCHAR(80),
   @VersionId        VARCHAR(20),
   @Description      VARCHAR(512),
   @CategoryId       VARCHAR(20),
   @DataOwnerId      VARCHAR(20),
   @OutIdNo          BIGINT OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
   IF NOT EXISTS(SELECT * 
                   FROM Data.DataCode 
                  WHERE CodeSetNo = @CodeSetNo
                    AND IdNo = @IdNo)
   BEGIN
      INSERT INTO Data.DataCode (
         OrganizationId,   CodeSetNo,     CodeId,
         AlternateId,      VersionId,     Description,
         CategoryId,       DataOwnerId,   UpdateSessionId)
      VALUES (
         @OrganizationId, @CodeSetNo,    @CodeId,
         @AlternateId,    @VersionId,    @Description,
         @CategoryId,     @DataOwnerId,  @SessionId)
      SET @OutIdNo = @@IDENTITY
   END
   ELSE
   BEGIN
      UPDATE Data.DataCode
         SET AlternateId = @AlternateId,
             VersionId = @VersionId,
             Description = @Description,
             CategoryId = @CategoryId,
             DataOwnerId = @DataOwnerId
       WHERE OrganizationId = @OrganizationId
         AND CodeSetNo = @CodeSetNo
         AND IdNo = @IdNo
      SET @OutIdNo = @IdNo
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropServiceContract]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

CREATE PROCEDURE Helper.HelperDropServiceContract
   @ContractName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM sys.service_contracts WHERE name = @ContractName)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP CONTRACT [' + @ContractName + ']'
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropServiceMessageType]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

-- DropServiceMessageType
CREATE PROCEDURE Helper.HelperDropServiceMessageType
   @TypeName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM sys.service_message_types WHERE name = @TypeName)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP MESSAGE TYPE [' + @TypeName + ']'
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropSchema]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Helper.HelperDropSchema
   @SchemaName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM sys.schemas WHERE name = @SchemaName)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP SCHEMA ' + @SchemaName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSchemaTablesSetAccess]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

-- we asume that 'Helper.HelperDropProcedure' was added as done above...

CREATE PROCEDURE Helper.HelperSchemaTablesSetAccess
   @CatalogName VARCHAR(80) = '',
   @SchemaName  VARCHAR(80) = '',
   @ViewerName  VARCHAR(80) = '',
   @EntryName   VARCHAR(80) = '',
   @EditorName  VARCHAR(80) = '',
   @AdminName   VARCHAR(80) = '',
   @TestOnly    BIT = 0
AS
BEGIN
   DECLARE @catalog VARCHAR(20),
           @schema  VARCHAR(20),
           @tblName VARCHAR(80),
           @tblType VARCHAR(20),
           @cmd     VARCHAR(128)

   SET @SchemaName  = rtrim(@SchemaName)
   SET @CatalogName = rtrim(@CatalogName)
   SET @AdminName   = rtrim(@AdminName)
   SET @ViewerName  = rtrim(@ViewerName)
   SET @EntryName   = rtrim(@EntryName)
   SET @EditorName  = rtrim(@EditorName)

   DECLARE SchmInitCursor CURSOR FOR
      SELECT Table_Schema, Table_Name, Table_Type
        FROM Information_Schema.Tables
       WHERE (Table_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Table_Schema = @SchemaName OR @SchemaName = '')
       ORDER BY Table_Name

   OPEN SchmInitCursor
   FETCH NEXT FROM SchmInitCursor
    INTO @schema,@tblName,@tblType

   WHILE @@FETCH_STATUS = 0
   BEGIN
      -- setup permissions to users
      IF @AdminName <> ''
      BEGIN
         SET @cmd = 'GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON '
            + @schema+'.'+@tblName+' TO '+@AdminName
         IF @TestOnly = 0
            EXECUTE(@cmd)
         --PRINT @cmd + ' -- DONE ('+@tblType+')'
      END

      IF @ViewerName <> ''
      BEGIN
         SET @cmd = 'GRANT SELECT ON '+@schema+'.'+@tblName+' TO '+@ViewerName
         IF @TestOnly = 0
            EXECUTE(@cmd)
         --PRINT @cmd + ' -- DONE ('+@tblType+')'
      END

      IF @EntryName <> ''
      BEGIN
         SET @cmd = 'GRANT INSERT, REFERENCES, SELECT, UPDATE ON '
            + @schema+'.'+@tblName+' TO '+@EntryName
         IF @TestOnly = 0
            EXECUTE(@cmd)
         --PRINT @cmd + ' -- DONE ('+@tblType+')'
      END

      IF @EditorName <> ''
      BEGIN
         SET @cmd = 'GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON '
            + @schema+'.'+@tblName+' TO '+@EditorName
         IF @TestOnly = 0
            EXECUTE(@cmd)
         --PRINT @cmd + ' -- DONE ('+@tblType+')'
      END

      --PRINT '---------------------------------------------------------------'

      -- Get the next table...
      FETCH NEXT FROM SchmInitCursor 
       INTO @schema,@tblName,@tblType
   END 

   CLOSE SchmInitCursor
   DEALLOCATE SchmInitCursor
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSetStartEndDates]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE  PROCEDURE Helper.HelperSetStartEndDates
   @StartDate    DATETIME,
   @EndDate      DATETIME,
   @OutStartDate DATETIME OUTPUT,
   @OutEndDate   DATETIME OUTPUT
AS
BEGIN
   SET NOCOUNT ON
   IF @StartDate is null
      SET @StartDate = '1900-01-01'
   IF @EndDate is null
      SET @EndDate = '2100-01-01'
   IF @StartDate > @EndDate
   BEGIN
      DECLARE @tmp DATETIME
      SET @tmp = @StartDate
      SET @StartDate = @EndDate
      SET @EndDate = @tmp
   END
   SET @OutStartDate = @StartDate
   SET @OutEndDate = @EndDate + 1
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropConstraint]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------
-- Provide a method to drop a constraint without writting and hidding any silly 
-- needed T-SQL code

CREATE PROCEDURE Helper.HelperDropConstraint
   @TableName NVARCHAR(80),
   @ConstraintName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM dbo.sysobjects
      WHERE name = @ConstraintName)
   BEGIN
      DECLARE @DropCommand VARCHAR(250)
      SET @DropCommand = 'ALTER TABLE ' +
         rtrim(@TableName) + ' DROP CONSTRAINT ' + @ConstraintName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropType]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------
-- Provide a method to drop a type without writting and hidding any silly 
-- needed T-SQL code

CREATE PROCEDURE Helper.HelperDropType
   @TypeName NVARCHAR(80)
AS
BEGIN
   DECLARE @name VARCHAR(80),
           @indx SMALLINT
   SET @indx = CHARINDEX('.',@TypeName,1)
   IF @indx > 0
      SET @name = SUBSTRING(@TypeName,@indx+1,LEN(@TypeName)-@indx)
   ELSE
      SET @name = @TypeName
   -- SELECT @indx, @name

   IF EXISTS (
      SELECT * FROM dbo.systypes
      WHERE name = @name)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP TYPE ' + @TypeName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropFunction]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------
-- Provide a method to drop a function without writting and hidding any silly 
-- needed T-SQL code
-- drop procedure Helper.HelperDropFunction

CREATE PROCEDURE Helper.HelperDropFunction
   @FunctionName NVARCHAR(80)
AS
BEGIN
   IF  EXISTS (SELECT * FROM sys.objects
        WHERE object_id = OBJECT_ID(@FunctionName)
          AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP FUNCTION ' + @FunctionName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropTable]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------
-- Provide a method to drop a table without writting and hidding any silly 
-- needed T-SQL code

CREATE PROCEDURE Helper.HelperDropTable
   @TableName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM dbo.sysobjects
      WHERE id = object_id(@TableName) 
        AND OBJECTPROPERTY(id, N'IsUserTable') = 1)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP TABLE ' + @TableName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropProcedure]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

CREATE PROCEDURE Helper.HelperDropProcedure
   @ProcedureName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM dbo.sysobjects
      WHERE id = object_id(@ProcedureName) 
        AND OBJECTPROPERTY(id, N'IsProcedure') = 1)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP PROCEDURE ' + @ProcedureName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropSequence]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

CREATE PROCEDURE Helper.HelperDropSequence
   @SequenceName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM dbo.sysobjects
      WHERE id = object_id(@SequenceName)  AND xtype = 'SO')
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP SEQUENCE ' + @SequenceName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropView]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

CREATE PROCEDURE Helper.HelperDropView
   @ProcedureName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM dbo.sysobjects
      WHERE id = object_id(@ProcedureName) 
        AND OBJECTPROPERTY(id, N'IsView') = 1)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP VIEW ' + @ProcedureName
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropService]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

CREATE PROCEDURE Helper.HelperDropService
   @ServiceName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM sys.services WHERE name = @ServiceName)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      SET @DropCommand = 'DROP SERVICE [' + @ServiceName + ']'
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDropServiceQueue]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

CREATE PROCEDURE Helper.HelperDropServiceQueue
   @Schema    NVARCHAR(80),
   @QueueName NVARCHAR(80)
AS
BEGIN
   IF EXISTS (
      SELECT * FROM sys.service_queues WHERE name = @QueueName)
   BEGIN
      DECLARE @DropCommand VARCHAR(128)
      IF @Schema = ''
         SET @DropCommand = 'DROP QUEUE [' + @QueueName + ']'
      ELSE
         SET @DropCommand = 'DROP QUEUE [' + @Schema + '].[' + @QueueName + ']'
      EXEC (@DropCommand)
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperDiagnosticsCodeAdd]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Helper.HelperDiagnosticsCodeAdd
   @SeverityNo  SMALLINT = 1,
   @CodeNo      INTEGER,
   @CategoryNo  SMALLINT,
   @MessageText VARCHAR(1024),
   @SpanishText VARCHAR(1024) = NULL
AS
BEGIN
   SET NOCOUNT ON
   IF @SpanishText is null or @SpanishText = ''
      SET @SpanishText = @MessageText
   IF @SeverityNo is null or @SeverityNo = 0
      SET @SeverityNo = 1
   IF EXISTS(SELECT * FROM Diagnostic.DiagnosticCodes
              WHERE CodeNo = @CodeNo)
      RETURN
   INSERT INTO Diagnostic.DiagnosticCodes
      ( CodeNo,       SeverityNo,          CategoryNo,
        Description,  SpanishDescription)
   VALUES
      (@CodeNo,      @SeverityNo,         @CategoryNo,
       @MessageText, @SpanishText)
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperResetBaseCouters]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Helper.HelperResetBaseCouters
AS
BEGIN
   SET NOCOUNT ON
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(EntityNo),0) + 1 FROM Entity.Registry)
    WHERE IdNo = 0
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(AddressNo),0) + 1 FROM Location.AddressRegistry)
    WHERE IdNo = 1
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(NameNo),0) + 1 FROM Entity.Names)
    WHERE IdNo = 2
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(ObjectNo),0) + 1 FROM Resource.Objects)
    WHERE IdNo = 4
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(AccountNo),0) + 1 FROM Account.Registry)
    WHERE IdNo = 5
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(KindNo),0) + 1 FROM Account.Kinds)
    WHERE IdNo = 6
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(CenterNo),0) + 1 FROM Center.Registry)
    WHERE IdNo = 7
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(UserNo),0) + 1 FROM Users.Registry)
    WHERE IdNo = 9
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(LogEntryNo),0) + 1 FROM Applications.Logs)
    WHERE IdNo = 10
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(SessionNo),0) + 1 FROM Applications.Sessions)
    WHERE IdNo = 11
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(DocumentNo),0) + 1 FROM Documents.Registry)
    WHERE IdNo = 13
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(DetailNo),0) + 1 FROM Documents.LineItems)
    WHERE IdNo = 14
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(ResourceNo),0) + 1 FROM Resource.Registry)
    WHERE IdNo = 16
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(CollectionNo),0) + 1 FROM Resource.Collections)
    WHERE IdNo = 17
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(DocumentNo),0) + 1 FROM Resource.XmlDocuments)
    WHERE IdNo = 18
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(ItemNo),0) + 1 FROM Resource.XmlDocumentCollectionItems)
    WHERE IdNo = 19
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(IdNo),0) + 1 FROM Entity.Ids)
    WHERE IdNo = 20
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(PhoneNo),0) + 1 FROM Entity.Phones)
    WHERE IdNo = 21
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(EntityUrlNo),0) + 1 FROM Entity.Urls)
    WHERE IdNo = 24
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(DocumentNo),0) + 1 FROM Documents.Registry)
    WHERE IdNo = 25
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(TransactionNo),0) + 1 FROM Ledger.JournalEntries)
    WHERE IdNo = 26
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(NoteNo),0) + 1 FROM Entity.Notes)
    WHERE IdNo = 27
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(TransactionNo),0) + 1 FROM HumanResources.Worksheets)
    WHERE IdNo = 28
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(GroupNo),0) + 1 FROM Documents.DetailsGroups)
    WHERE IdNo = 29
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(AccountNo),0) + 1 FROM HumanResources.Accounts)
    WHERE IdNo = 30
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(ProfileNo),0) + 1 FROM HumanResources.AccountProfiles)
    WHERE IdNo = 31
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(PeriodNo),0) + 1 FROM Period.Registry)
    WHERE IdNo = 32
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(DeviceNo),0) + 1 FROM Center.DeviceRegistry)
    WHERE IdNo = 33
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(MediaNo),0) + 1 FROM Media.Registry)
    WHERE IdNo = 35
   UPDATE IdBase.Counters
      SET IdCount = (SELECT isnull(max(ParamNo),0) + 1 FROM Resource.Parameters)
    WHERE IdNo = 36
   --UPDATE IdBase.Counters
   --   SET IdCount = (SELECT isnull(max(EventNo),0) + 1 FROM Event.Registry)
   -- WHERE IdNo = 37
   --UPDATE IdBase.Counters
   --   SET IdCount = (SELECT isnull(max(ProfileNo),0) + 1 FROM Inventory.EquipmentProfiles)
   -- WHERE IdNo = 40
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSchemaSetAccess]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- exec Helper.HelperSchemaDropObjects 'Kifv1','',0
-- exec Helper.HelperSchemaDropObjects 'Kifv1','',1

-- -----------------------------------------------------------------------------
-- EXEC Helper.HelperDropProcedure 'Helper.HelperSchemaSetAccess'

CREATE PROCEDURE Helper.HelperSchemaSetAccess
   @SchemaName      VARCHAR(80),
   @Option          CHAR(1),
   @ObjName         VARCHAR(80),
   @ViewerRoleName  VARCHAR(80) = '',
   @EntryRoleName   VARCHAR(80) = '',
   @EditorRoleName  VARCHAR(80) = '',
   @ObjType         VARCHAR(80) = '',
   @TestOnly        BIT = 0
AS
BEGIN
   DECLARE @cmd     VARCHAR(128),
           @header  VARCHAR(80),
           @opt     CHAR(1)
   SET @header = 'GRANT EXECUTE ON '

   IF @Option = 'E'
      SET @opt = 'F'
   ELSE
      SET @opt = @Option

   IF @ViewerRoleName <> '' AND @opt = 'F'
   BEGIN
      SET @cmd = @header + @SchemaName + '.' + @ObjName+' TO '+@ViewerRoleName
      IF @TestOnly = 0
         EXECUTE(@cmd)
      ELSE
         PRINT @cmd + ' -- DONE ('+@Option+': '+@ObjType+')'
   END

   IF @EntryRoleName <> '' AND (@opt = 'F' OR @opt = 'M')
   BEGIN
      SET @cmd = @header + @SchemaName + '.' + @ObjName+' TO '+@EntryRoleName
      IF @TestOnly = 0
         EXECUTE(@cmd)
      ELSE
         PRINT @cmd + ' -- DONE ('+@Option+': '+@ObjType+')'
   END

   IF @EditorRoleName <> '' AND (@opt = 'F' OR @opt = 'M' OR @opt = 'D')
   BEGIN
      SET @cmd = @header + @SchemaName + '.' + @ObjName+' TO '+@EditorRoleName
      IF @TestOnly = 0
         EXECUTE(@cmd)
      ELSE
         PRINT @cmd + ' -- DONE ('+@Option+': '+@ObjType+')'
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSchemaDropObjects]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- EXEC Helper.HelperSchemaObjectsRevokeAccess '','','kifViewer',1
-- test schema initialization
-- EXEC Helper.HelperSchemaTablesSetAccess '','Resource','Admin','Viewer','Editor',1
-- EXEC Helper.HelperSchemaTablesSetAccess '','Resource','Admin','','',1
-- EXEC Helper.HelperSchemaTablesSetAccess '','Resource','','Viewer','',1
-- EXEC Helper.HelperSchemaTablesSetAccess '','Resource','','','Editor',1

-- -----------------------------------------------------------------------------

-- we asume that 'Helper.HelperDropProcedure' was added as done above...

CREATE PROCEDURE Helper.HelperSchemaDropObjects
   @CatalogName VARCHAR(80) = '',
   @SchemaName  VARCHAR(80) = '',
   @TestOnly    BIT = 0
AS
BEGIN
   DECLARE @catalog VARCHAR(20),
           @schema  VARCHAR(20),
           @objName VARCHAR(80),
           @objType VARCHAR(20),
           @cmd     VARCHAR(128),
           @option  CHAR(1)

   SET @SchemaName  = rtrim(@SchemaName)
   SET @CatalogName = rtrim(@CatalogName)

   DECLARE SchmInitCursor CURSOR FOR
      SELECT 'R' Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM Information_Schema.Routines
       WHERE (Routine_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Routine_Schema = @SchemaName OR @SchemaName = '')

   OPEN SchmInitCursor
   FETCH NEXT FROM SchmInitCursor
    INTO @option,@schema,@objName,@objType

   WHILE @@FETCH_STATUS = 0
   BEGIN
      -- revoke all permissions to users
      SET @cmd = 'DROP ' + @objType + ' ' + @schema+'.'+@objName
      IF @TestOnly = 0
         EXECUTE(@cmd)
      PRINT @cmd + ' -- DONE ('+@objType+')'
      --PRINT '---------------------------------------------------------------'

      -- Get the next table...
      FETCH NEXT FROM SchmInitCursor 
       INTO @option,@schema,@objName,@objType
   END 

   CLOSE SchmInitCursor
   DEALLOCATE SchmInitCursor
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSchemaObjectsRevokeAccess]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

-- we asume that 'Helper.HelperDropProcedure' was added as done above...

CREATE PROCEDURE Helper.HelperSchemaObjectsRevokeAccess
   @CatalogName VARCHAR(80) = '',
   @SchemaName  VARCHAR(80) = '',
   @UserName    VARCHAR(80) = '',
   @TestOnly    BIT = 0
AS
BEGIN
   DECLARE @catalog VARCHAR(20),
           @schema  VARCHAR(20),
           @objName VARCHAR(80),
           @objType VARCHAR(20),
           @cmd     VARCHAR(128),
           @option  CHAR(1)

   SET @SchemaName  = rtrim(@SchemaName)
   SET @CatalogName = rtrim(@CatalogName)
   SET @UserName    = rtrim(@UserName)

   DECLARE SchmInitCursor CURSOR FOR
      SELECT 'T' Object_Option, Table_Schema,   Table_Name,    Table_Type
        FROM Information_Schema.Tables
       WHERE (Table_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Table_Schema = @SchemaName OR @SchemaName = '')
       UNION
      SELECT 'R' Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM Information_Schema.Routines
       WHERE (Routine_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Routine_Schema = @SchemaName OR @SchemaName = '')

   OPEN SchmInitCursor
   FETCH NEXT FROM SchmInitCursor
    INTO @option,@schema,@objName,@objType

   WHILE @@FETCH_STATUS = 0
   BEGIN
      -- revoke all permissions to users
      IF @option = 'T'
      BEGIN
         SET @cmd = 'REVOKE DELETE, INSERT, REFERENCES, SELECT, UPDATE ON '
            + @schema+'.'+@objName+' TO '+@UserName
         IF @TestOnly = 0
            EXECUTE(@cmd)
         --PRINT @cmd + ' -- DONE ('+@objType+')'
         --PRINT '---------------------------------------------------------------'
      END
      ELSE
      BEGIN
         SET @cmd = 'REVOKE EXECUTE ON '
            + @schema+'.'+@objName+' TO '+@UserName
         IF @TestOnly = 0 AND @objType <> 'FUNCTION'
            EXECUTE(@cmd)
         --PRINT @cmd + ' -- DONE ('+@objType+')'
         --PRINT '---------------------------------------------------------------'
      END

      -- Get the next table...
      FETCH NEXT FROM SchmInitCursor 
       INTO @option,@schema,@objName,@objType
   END 

   CLOSE SchmInitCursor
   DEALLOCATE SchmInitCursor
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [IdBase].[IdBaseGetNewPrefixedYmdhmId]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE IdBase.IdBaseGetNewPrefixedYmdhmId
   @SessionId      VARCHAR(40),
   @OrganizationId VARCHAR(20),
   @PrefixId       VARCHAR(2),
   @OutId          VARCHAR(20) OUTPUT
AS
BEGIN
   SET NOCOUNT ON
   SET @OutId = NULL

   -- current running year and other needed info
   DECLARE @ct         DATETIME,
           @currYear   CHAR(4),
           @currMonth  CHAR(2),
           @currDay    CHAR(2),
           @currHour   CHAR(2),
           @currMins   CHAR(2),
           @currCount  INTEGER

   SET @ct       = getdate()
   SET @currYear = cast(year(@ct) as char(4))
   SET @currMonth= substring(cast(month(@ct) as char(2)),1,2)
   SET @currDay  = substring(cast(day(@ct) as char(2)),1,2)
   SET @currHour = substring(cast(datepart(hh,@ct) as char(2)),1,2)
   SET @currMins = substring(cast(datepart(mi,@ct) as char(2)),1,2)

   IF len(@currMonth) = 1
      SET @currMonth = '0' + @currMonth
   IF len(@currDay) = 1
      SET @currDay = '0' + @currDay
   IF len(@currHour) = 1
      SET @currHour = '0' + @currHour
   IF len(@currMins) = 1
      SET @currMins = '0' + @currMins

   -- make sure we are doing this in isolation
   SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
   BEGIN TRANSACTION

   IF NOT EXISTS(SELECT * FROM IdBase.IdBasePrefixCounters
                  WHERE OrganizationId = @OrganizationId
                    AND PrefixId = @PrefixId)
   BEGIN
      INSERT INTO IdBase.IdBasePrefixCounters
         ( OrganizationId,  PrefixId,  IdString,  Description,  IdCount)
      VALUES
         (@OrganizationId, @PrefixId, @PrefixId, @PrefixId,     -1) 
    
      IF (@@ERROR <> 0)
      BEGIN
         ROLLBACK TRAN
         SET TRANSACTION ISOLATION LEVEL READ COMMITTED
         RETURN -1001
      END
   END

   -- get previous counter / year info
   SELECT @currCount = IdCount
     FROM IdBase.IdBasePrefixCounters
    WHERE OrganizationId = @OrganizationId
      AND PrefixId = @PrefixId

   IF (@@ERROR <> 0)
   BEGIN
      ROLLBACK TRAN
      SET TRANSACTION ISOLATION LEVEL READ COMMITTED
      RETURN -1002
   END
   
   IF @currCount is null
   BEGIN
      INSERT INTO IdBase.IdBasePrefixCounters
         (PrefixId, OrganizationId, IdCount, IdString, Description)
      VALUES
         (@PrefixId, @OrganizationId, -1, '', '')
   END

   -- make sure that we don't overflow count
   IF @currCount >= 999999 or @currCount is null
      SET @currCount = -1

   -- expected daily normal state-id count
   SET @currCount = @currCount + 1
   UPDATE IdBase.IdBasePrefixCounters
      SET IdCount = @currCount
    WHERE OrganizationId = @OrganizationId
      AND PrefixId = @PrefixId

   IF (@@ERROR <> 0)
   BEGIN
      ROLLBACK TRAN
      SET TRANSACTION ISOLATION LEVEL READ COMMITTED
      RETURN -1003
   END

   -- finally build the new State Id
   DECLARE @new VARCHAR(10)

   SET @new = rtrim(cast(@currCount as varchar(6)))
   SET @new = replicate('0',6-len(@new))+@new
   SET @OutId = @PrefixId + @currYear + @currMonth + @currDay +
      @currHour + @currMins + @new

   -- commit transaction
   COMMIT TRANSACTION
   SET TRANSACTION ISOLATION LEVEL READ COMMITTED
END  -- end of IdBase.IdBaseGetNewPrefixedYmId
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [IdBase].[IdBaseGetNewBaseNo]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE IdBase.IdBaseGetNewBaseNo
   @CounterIdNo     INTEGER,
   @NumberOfEntries INTEGER,
   @NewIdNo         INTEGER OUTPUT
-- WITH EXECUTE AS 'kifEntry'
AS
BEGIN
   SET NOCOUNT ON
   IF @NumberOfEntries <= 0
      SET @NumberOfEntries = 1

   SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
   BEGIN TRANSACTION

   DECLARE @cnt    INTEGER,
           @newcnt INTEGER

   SELECT @cnt = IdCount FROM IdBase.IdBaseCounters
    WHERE IdNo = @CounterIdNo

   IF (@@ERROR <> 0)
   BEGIN
      ROLLBACK TRAN
      SET TRANSACTION ISOLATION LEVEL READ COMMITTED
      RETURN -9991
   END

   SET @newcnt = @cnt + @NumberOfEntries

   UPDATE IdBase.IdBaseCounters SET IdCount = @newcnt
    WHERE IdNo = @CounterIdNo

   IF (@@ERROR <> 0)
   BEGIN
      ROLLBACK TRAN
      SET TRANSACTION ISOLATION LEVEL READ COMMITTED
      RETURN -9992
   END

   -- commit transaction

   COMMIT TRANSACTION
   SET TRANSACTION ISOLATION LEVEL READ COMMITTED

   SET @NewIdNo = @cnt
END  -- end of IdBase.IdBaseGetNewBaseNo
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [IdBase].[IdBaseGetNewNo]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE IdBase.IdBaseGetNewNo
   @CounterIdNo INTEGER,
   @NewIdNo     INTEGER OUTPUT
-- WITH EXECUTE AS 'kifEntry'
AS
BEGIN
   SET NOCOUNT ON
   SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
   BEGIN TRANSACTION

   DECLARE @cnt    INTEGER,
           @newcnt INTEGER

   SELECT @cnt = IdCount FROM IdBase.IdBaseCounters
    WHERE IdNo = @CounterIdNo

   IF (@@ERROR <> 0)
   BEGIN
      ROLLBACK TRAN
      SET TRANSACTION ISOLATION LEVEL READ COMMITTED
      RETURN -9991
   END

   SET @newcnt = @cnt + 1

   UPDATE IdBase.IdBaseCounters SET IdCount = @newcnt
    WHERE IdNo = @CounterIdNo

   IF (@@ERROR <> 0)
   BEGIN
      ROLLBACK TRAN
      SET TRANSACTION ISOLATION LEVEL READ COMMITTED
      RETURN -9992
   END

   -- commit transaction

   COMMIT TRANSACTION
   SET TRANSACTION ISOLATION LEVEL READ COMMITTED

   SET @NewIdNo = @cnt
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [IdBase].[IdBaseGroupMembersGetRecords]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE IdBase.IdBaseGroupMembersGetRecords
   @SessionId  VARCHAR(40),
   @LanguageNo SMALLINT = 0
-- WITH EXECUTE AS 'kifEntry'
AS
BEGIN
   SET NOCOUNT ON
   SELECT GroupNo,
          TypeNo,
          Length,
          Template,
          Required,
          TableName,
          TypeName,
          GroupDescription,
          TypeDescription
     FROM IdBase.IdBaseGroupMembersList(@LanguageNo)
    ORDER BY GroupDescription,
             TypeDescription
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordGet
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @Items               Reference.ReferenceDataElementCollectionItem READONLY
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordGet'
   --IF @diagrval <> 0
   --   RETURN @diagrval
   IF @OperationType not in (20)
      RETURN -112 -- Invalid Reference Data Operation

   -- prepare query
   DECLARE @totalRecord INTEGER = (SELECT count(*) FROM @Items),
           @count       INTEGER = 0,
           @field       VARCHAR(128),
           @type        SMALLINT,
           @key         SMALLINT,
           @value       VARCHAR(128),
           @cols        NVARCHAR(MAX) = '',
           @wer         NVARCHAR(1024) = '',
           @qry         NVARCHAR(MAX) = ''

   WHILE @count < @totalRecord
   BEGIN
      SELECT @field = Name,
             @type  = ValueType,
             @key   = KeyType,
             @value = ValueText
        FROM @Items
       WHERE SerialNo = @count

      IF @field = 'OrganizationId'
         SET @wer = @wer + case when len(@wer) = 0 then ' WHERE ' else ' AND ' end
                  + QUOTENAME(@field) + ' = ''' + @OrganizationId + ''''
      SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
                + QUOTENAME(@field)

      SET @count = @count + 1
   END
   DECLARE @result INTEGER
   SET @qry = 'SELECT ' + @cols + ' FROM ' +
            + String.StringQuotedShemaTable(@ReferenceObjectName) + @wer
   EXEC(@qry)
   --SELECT @qry
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordCallProcedure]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordCallProcedure
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @Items               Reference.ReferenceDataElementCollectionItem READONLY,
   @OptionNo            SMALLINT = 0,
   @OutResult           VARCHAR(1024) OUTPUT
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   SET @OutResult = ''
   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordCallProcedure'
   --IF @diagrval <> 0
   --   RETURN @diagrval
   IF @OperationType not in (30)
      RETURN -112 -- Invalid Reference Data Operation

   -- prepare query
   DECLARE @totalRecord INTEGER = (SELECT count(*) FROM @Items),
           @count       INTEGER = 0,
           @field       VARCHAR(128),
           @type        SMALLINT,
           @key         SMALLINT,
           @params      NVARCHAR(MAX) = '',
           @value       NVARCHAR(1024),
           @qry         NVARCHAR(MAX) = ''

   WHILE @count < @totalRecord
   BEGIN
      SELECT @field = Name,
             @type  = ValueType,
             @key   = KeyType,
             @value = ValueText
        FROM @Items
       WHERE SerialNo = @count
                     
      IF @field = 'OrganizationId' or @field = '@OrganizationId'
      BEGIN
         SET @key = 1
         SET @value = @OrganizationId
      END

      SET @params = @params + case when len(@params) = 0 then '' else ',' end
                  + String.StringQuotedValue(@field,9999) + '='
                  + String.StringQuotedValue(@value,@type)

      SET @count = @count + 1
   END
   DECLARE @result   INTEGER,
           @optional VARCHAR(1024) = ''
   IF @OptionNo = 1
      SET @optional =  case when len(@params) = 0 then '' else ',' end
			+ '@OptionNo=' + cast(@OptionNo as varchar)
			+ ',@OutResult=@OutResult OUTPUT'
   
   SET @qry = 'EXEC ' 
            + String.StringQuotedShemaTable(@ReferenceObjectName) 
            + ' ' + @params + case when len(@params) = 0 then '' else ',' end
			+ @optional
   EXEC(@qry)
   --SELECT @qry
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordStatusUpdate]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordStatusUpdate
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @Items               Reference.ReferenceDataElementCollectionItem READONLY,
   @OptionNo            SMALLINT = 0
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordUpdate'
   --IF @diagrval <> 0
   --   RETURN @diagrval
   IF @OperationType not in (20)
      RETURN -112 -- Invalid Reference Data Operation
         
   DECLARE @sts CHAR(1) =
      case @OptionNo when 1 then 'A'
                     when 2 then 'I'
                     when -1 then 'X'
                     when 999 then 'D' else '*' end

   IF @sts = '*'
      RETURN -114 -- Invalid Reference Data Record Status Value

   -- prepare query
   DECLARE @totalRecord INTEGER = (SELECT count(*) FROM @Items),
           @count       INTEGER = 0,
           @field       VARCHAR(128),
           @type        SMALLINT,
           @key         SMALLINT,
           @value       VARCHAR(128),
           @cols        NVARCHAR(MAX) = '',
           @wer         NVARCHAR(MAX) = '',
           @qry         NVARCHAR(MAX) = ''

   WHILE @count < @totalRecord
   BEGIN
      SET @value = null
      SELECT @field = Name,
             @type  = ValueType,
             @key   = KeyType,
             @value = ValueText
       FROM @Items
       WHERE SerialNo = @count
              
      IF @field = 'OrganizationId'
      BEGIN
         SET @key = 1
         SET @value = @OrganizationId
      END

      IF @key = 1
         SET @wer  = @wer + case when len(@cols) = 0 then '' else ' AND ' end
                   + QUOTENAME(@field) + '='
                   + String.StringQuotedValue(@value,@type)

      SET @count = @count + 1
   END

   SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
             + QUOTENAME('RecordStatusCode') + '='
             + '''' + @sts + ''''
   SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
             + QUOTENAME('UpdateSessionID') + '='
             + '''' + @SessionId + ''''
   SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
             + QUOTENAME('LastUpdateDate') + '='
             + '''' + convert(varchar(20),getutcdate(),120) + ''''

   DECLARE @result INTEGER
   SET @qry = 'UPDATE ' 
            + String.StringQuotedShemaTable(@ReferenceObjectName) 
            + ' SET ' + @cols
            + ' WHERE ' + @wer
   EXEC(@qry)
   --SELECT @qry
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordUpdate]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordUpdate
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @Items               Reference.ReferenceDataElementCollectionItem READONLY,
   @OptionNo            SMALLINT = 0
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordUpdate'
   --IF @diagrval <> 0
   --   RETURN @diagrval
   IF @OperationType not in (20)
      RETURN -112 -- Invalid Reference Data Operation

   -- prepare query
   DECLARE @totalRecord INTEGER = (SELECT count(*) FROM @Items),
           @count       INTEGER = 0,
           @field       VARCHAR(128),
           @type        SMALLINT,
           @key         SMALLINT,
           @value       VARCHAR(128),
           @cols        NVARCHAR(MAX) = '',
           @wer         NVARCHAR(MAX) = '',
           @qry         NVARCHAR(MAX) = ''

   WHILE @count < @totalRecord
   BEGIN
      SELECT @field = Name,
             @type  = ValueType,
             @key   = KeyType,
             @value = ValueText
       FROM @Items
       WHERE SerialNo = @count
       
      IF @field = 'OrganizationId'
      BEGIN
         SET @key = 1
         SET @value = @OrganizationId
      END

      IF @key = 1
         SET @wer  = @wer + case when len(@cols) = 0 then '' else ' AND ' end
                   + QUOTENAME(@field) + '='
                   + String.StringQuotedValue(@value,@type)
      ELSE IF @field = 'RecordStatusCode'
      BEGIN
         SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
                   + QUOTENAME(@field) + '='
                   + 'case when RecordStatusCode is null or RecordStatusCode='''' then ''A'' else RecordStatusCode end'
      END
      ELSE
         SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
                   + QUOTENAME(@field) + '='
                   + String.StringQuotedValue(@value,@type)

      SET @count = @count + 1
   END

   SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
             + QUOTENAME('UpdateSessionID') + '='
             + '''' + @SessionId + ''''
   SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
             + QUOTENAME('LastUpdateDate') + '='
             + '''' + convert(varchar(20),getutcdate(),120) + ''''

   DECLARE @result INTEGER
   SET @qry = 'UPDATE ' 
            + String.StringQuotedShemaTable(@ReferenceObjectName) 
            + ' SET ' + @cols
            + ' WHERE ' + @wer
   EXEC(@qry)
   --SELECT @qry
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordInsert]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordInsert
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @Items               Reference.ReferenceDataElementCollectionItem READONLY
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordInsert'
   --IF @diagrval <> 0
   --   RETURN @diagrval
   IF @OperationType not in (20)
      RETURN -112 -- Invalid Reference Data Operation

   -- prepare query
   DECLARE @totalRecord INTEGER = (SELECT count(*) FROM @Items),
           @count       INTEGER = 0,
           @field       VARCHAR(128),
           @type        SMALLINT,
           @key         SMALLINT,
           @value       VARCHAR(128),
           @cols        NVARCHAR(MAX) = '',
           @vals        NVARCHAR(MAX) = '',
           @qry         NVARCHAR(MAX) = ''

   WHILE @count < @totalRecord
   BEGIN
      SELECT @field = Name,
             @type  = ValueType,
             @key   = KeyType,
             @value = ValueText
        FROM @Items
       WHERE SerialNo = @count
       
      IF @field = 'OrganizationId'
      BEGIN
         SET @key = 1
         SET @value = @OrganizationId
      END

      -- A-active; I-Inactive; D-deleted; P-permanent-deleted, S-seald
      IF @field = 'RecordStatusCode' and (@value is null or @value = '' or
         @value not in ('A','I','D','X','S'))
         SET @value = 'A'

      SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
                + QUOTENAME(@field)
      SET @vals = @vals + case when len(@vals) = 0 then '' else ',' end
                + String.StringQuotedValue(@value,@type)

      SET @count = @count + 1
   END

   -- add Update Session ID...
   SET @cols = @cols + case when len(@cols) = 0 then '' else ',' end
             + QUOTENAME('UpdateSessionID')
   SET @vals = @vals + case when len(@vals) = 0 then '' else ',' end
             + '''' + @SessionId + ''''

   -- prepare and execute query
   DECLARE @result INTEGER
   SET @qry = 'INSERT INTO ' 
            + String.StringQuotedShemaTable(@ReferenceObjectName) 
            + ' (' + @cols + ') VALUES (' + @vals + ')'
   EXEC(@qry)
   --SELECT @qry
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordExists]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordExists
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @CheckRecord         BIT = 0,
   @Items               Reference.ReferenceDataElementCollectionItem READONLY
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordExists'
   --IF @diagrval <> 0
   --   RETURN @diagrval
   IF @OperationType not in (20)
      RETURN -112 -- Invalid Reference Data Operation

   -- prepare query
   DECLARE @totalRecord INTEGER = (SELECT count(*) FROM @Items),
           @count       INTEGER = 0,
           @field       VARCHAR(128),
           @type        SMALLINT,
           @key         SMALLINT,
           @value       VARCHAR(128),
           @conds       VARCHAR(1024) = '',
           @qry         NVARCHAR(MAX) = ''

   WHILE @count < @totalRecord
   BEGIN
      SELECT @field = Name,
             @type  = ValueType,
             @key   = KeyType,
             @value = ValueText
        FROM @Items
       WHERE SerialNo = @count
      IF @key = 1 or @CheckRecord = 1
      BEGIN
         IF @field = 'OrganizationId'
            SET @value = @OrganizationId
         SET @conds = @conds + 
            case when @conds = '' then '' else ' AND ' end + 
            QUOTENAME(@field) + '=' + String.StringQuotedValue(@value,@type)
      END
      SET @count = @count + 1
   END
   DECLARE @result INTEGER
   SET @qry = 'SET @result='
   SET @qry = @qry +'(case when EXISTS(SELECT * FROM ' + 
      String.StringQuotedShemaTable(@ReferenceObjectName) + ' WHERE (' +
      @conds + ')) then 1 else 0 end)'
   EXEC sp_executesql @qry, N'@result INTEGER OUTPUT', @result OUTPUT
   --SELECT @qry
   RETURN @result
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataTemplateMappingGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataTemplateMappingGet
   @SessionId      VARCHAR(40),
   @OrganizationId VARCHAR(20),
   @TemplateNo     BIGINT = null,
   @ResourceName   VARCHAR(128) = null
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   DECLARE @mapData      VARCHAR(MAX),
           @parentNodeNo BIGINT,
           @childNodeNo  BIGINT,
           @pTableName   VARCHAR(128),
           @cTableName   VARCHAR(128),
           @pElement     VARCHAR(128),
           @cElement     VARCHAR(128),
           @dElement     VARCHAR(128),
           @gElement     VARCHAR(128),
           @lElement     VARCHAR(128),
           @sValue       VARCHAR(128),
           @dValue       VARCHAR(128),
           @title        VARCHAR(128),
           @query        VARCHAR(1024)

   IF @TemplateNo is null 
   BEGIN
      SELECT @TemplateNo = TemplateNo 
        FROM Reference.ReferenceDataEditTemplate
       WHERE OrganizationId = @OrganizationId
         AND ResourceName = @ResourceName
   END

   DECLARE @tbl table(ObjectNo int,                        Type smallint,
                      ParentNodeNo bigint,                 ChildNodeNo bigint,
                      Name varchar(128),                   Description varchar(128),
                      ParentElementName varchar(128),      ChildElementName varchar(128),
                      DescriptionElementName varchar(128), Title varchar(128),
                      SelectedValue      varchar(128),     DefaultValue varchar(128),
                      LinkName varchar(128),               LinkType int,
                      LinkObjectNo int,                    GroupElementName varchar(128),
                      LinkElementName varchar(128),        Id int identity primary key) 

   SELECT @mapData = MapData
     FROM Reference.ReferenceDataEditTemplate
    WHERE TemplateNo = @TemplateNo
   -- SELECT @mapData

   INSERT INTO @tbl (ObjectNo,          Type,              ParentNodeNo,
                     ChildNodeNo,       Name,              Description,
                     ParentElementName, ChildElementName,  DescriptionElementName,
                     Title,             SelectedValue,     DefaultValue,
                     LinkName,          LinkType,          LinkObjectNo,
                     GroupElementName,  LinkElementName)
   SELECT a.ObjectNo,          a.Type,              a.ParentNodeNo,
          a.ChildNodeNo,       a.Name,              a.Description,
          b.ParentElementName, b.ChildElementName,  b.DescriptionElementName,
          b.Title,             b.SelectedValue,     b.DefaultValue,
          b.Name,              b.Type,              b.ObjectNo,
          b.GroupElementName,  b.LinkElementName
 --SELECT *
     FROM OPENJSON(@mapData)  
     WITH (ObjectNo     int,
           Type         smallint,
           ParentNodeNo int,
           ChildNodeNo  int,
           Name         varchar(128),
           Description  varchar(80),
           Link         nvarchar(max) AS JSON) a
     CROSS APPLY OPENJSON(a.Link)
      WITH (ParentElementName      varchar(128),
            ChildElementName       varchar(128),
            DescriptionElementName varchar(128),
            GroupElementName       varchar(128),
            LinkElementName        varchar(128),
            Title                  varchar(128),
            SelectedValue          varchar(128),
            DefaultValue           varchar(128),
            Name                   varchar(128),
            Type                   smallint,
            ObjectNo               int) b

   --SELECT * from @tbl
   DECLARE @cnt INTEGER = 1,
           @tot SMALLINT = (SELECT count(*) FROM @tbl),
           @gel varchar(512)
   WHILE @cnt <= @tot
   BEGIN
   
      SELECT @parentNodeNo = ParentNodeNo,
             @childNodeNo = ChildNodeNo,
             @pElement = ParentElementName,
             @cElement = ChildElementName,
             @dElement = DescriptionElementName,
             @gElement = GroupElementName,
             @lElement = LinkElementName,
             @sValue = SelectedValue,
             @dValue = DefaultValue,
             @title = Title
        FROM @tbl
       WHERE Id = @cnt

      SELECT @pTableName = ResourceName
        FROM Reference.ReferenceDataEditTemplate 
       WHERE TemplateNo = @parentNodeNo
      SELECT @cTableName = ResourceName
        FROM Reference.ReferenceDataEditTemplate 
       WHERE TemplateNo = @childNodeNo

      SELECT @parentNodeNo ParentNodeNo,
          -- @pTableName ParentResourceName,
             @childNodeNo  ChildNodeNo,
          -- @cTableName ChildResourceName,
             @pElement ParentElementName,
             @cElement ChildElementName,
             @dElement DescriptionElementName,
             @gElement GroupElementName,
             @lElement LinkElementName,
             @sValue SelectedValue,
             @dValue DefaultValue,
             @title Title

      SET @gel = ''
      IF @gElement is not null
         SET @gel = ' [' + @gElement + '] GroupId,'
      SET @query = 'SELECT ' + @gel + ' [' + @pElement + '] CodeId, [' + @dElement + '] Description ' +
                   'FROM ' + String.StringQuotedShemaTable(@pTableName)
      EXEC(@query)

      --SELECT *
      --  FROM @tbl
      -- WHERE Id = @cnt
      SET @cnt = @cnt + 1
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataDomainUpsert]...';


GO

CREATE PROCEDURE Data.DataDomainUpsert
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @DomainNo         INTEGER = NULL,
   @DomainId         VARCHAR(20),
   @DataOwnerId      VARCHAR(20),
   @ReferenceDate    DATETIME = null,
   @DomainUri        VARCHAR(2048),
   @DomainUriPrefix  VARCHAR(20),
   @Root             VARCHAR(1024) = null,
   @Domain           VARCHAR(2048) = null,
   @DomainName       VARCHAR(256),
   @TypeNo           SMALLINT = 0,
   @Description      VARCHAR(MAX),
   @OptionNo         SMALLINT = 0,  -- 0 = insert or update only
   @OutDomainID      VARCHAR(20) OUTPUT,
   @OutDomainNo      INTEGER OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON

   DECLARE @did VARCHAR(20),
           @dno INTEGER

   SELECT @did = DomainId,
          @dno = DomainNo
     FROM Data.DataDomain
    WHERE OrganizationId = @OrganizationId
      AND ((DomainNo = @DomainNo
      AND   DomainId = @DomainId)
       OR  DomainURI = @DomainUri)

   IF @did is null
   BEGIN
      IF @DomainId is null or @DomainId = ''
      BEGIN
         SELECT @did = DomainId,
                @dno = DomainNo
           FROM Data.DataDomain
          WHERE OrganizationId = @OrganizationId
            AND DomainUri = @DomainUri
      END
      ELSE
         SET @did = @DomainId
   END

   SET @OutDomainNo = @dno
   SET @OutDomainId = @did

   IF @ReferenceDate is null
      SET @ReferenceDate = getutcdate()
			
   -- 1 - If Domain ID & No exists then return
   IF @OptionNo = 1 and @did is not null and @dno is not NULL
      RETURN
			
   IF @did is null
   BEGIN
      -- 110 = Domain URI Prefix
      DECLARE @desc VARCHAR(1024) = 'Domain URI Prefix - ' + @DomainUriPrefix
      EXEC Data.DataReferenceObjectNew @SessionId = @SessionId, @ReferenceDate = @ReferenceDate,
         @ReferenceTypeNo = 110, @AliasId = @DomainUriPrefix, @AlternateId = @DomainUriPrefix,
         @Description = @desc, @StatusNo = 1, @OutReferenceId = @did OUTPUT
   END
	 
   DECLARE @ptxt VARCHAR(256) = 'Prefix - ' + @DomainUriPrefix + '. Root - ' + @Root + '. Domain - ' + @Domain
   IF @Description is null
      SET @Description = @ptxt
   IF @DomainName is NULL
      SET @DomainName = @ptxt
						
   IF @OutDomainNo is NULL
   BEGIN
      INSERT INTO Data.DataDomain (
         OrganizationId,  DataOwnerId, Prefix,
         Root,            Domain,      TypeNo,
         DomainId,        DomainUri,   DomainName,
         Description,     UpdateSessionId)
      VALUES (
        @OrganizationId, @DataOwnerId, @DomainUriPrefix,
        @Root,           @Domain,      @TypeNo,
        @did,            @DomainUri,   @DomainName,
        @Description,    @SessionId)
      SET @OutDomainNo = @@IDENTITY
   END
   ELSE
   -- 2 = Force update
   IF @OptionNo = 2
   BEGIN
      UPDATE Data.DataDomain
         SET DomainName = @DomainName,
             Description = @Description,
             UpdateSessionId = @SessionId,
             LastUpdateDate = (getutcdate())
       WHERE DomainNo = @OutDomainNo						
   END
END
GO
PRINT N'Creating Procedure [Data].[DataTermUpsert]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataTermUpsert
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @DataOwnerId      VARCHAR(20),

   -- reference object info
   @ReferenceDate    DATETIME2 = NULL,
   @ReferenceTypeNo  SMALLINT = NULL,
   @AliasId          VARCHAR(20) = NULL,
   @AlternateId      VARCHAR(40) = NULL,
   @Description      VARCHAR(MAX) = NULL,
   @StatusNo         SMALLINT = NULL,

   -- term info
   @ExpiredDate      DATETIME2 = NULL,
   @DomainNo         INTEGER = NULL,
   @TermId           VARCHAR(20) = NULL,
   @TermURI          VARCHAR(1024),
   @TermName         VARCHAR(80),
   @ConfidenceScore  DECIMAL(6,5) = NULL,
   @OutTermId        VARCHAR(20) OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
   SET @OutTermId = @TermId
   
   IF @AliasId is null
      SET @AliasId = 'OBJ'
   IF @ReferenceDate is null
      SET @ReferenceDate = getutcdate()
   IF @ReferenceTypeNo is null
      SET @ReferenceTypeNo = 20  -- Term
   IF @StatusNo is null
      SET @StatusNo = 1          -- active
   IF @DomainNo is null
      SET @DomainNo = (SELECT DomainNo FROM Data.DataDomain WHERE DomainName = 'Unknown')

   IF @OutTermId is null
   BEGIN
      DECLARE @desc VARCHAR(1024) = 'Reference (' + @TermName + ')'
      EXEC Data.DataReferenceObjectNew @SessionId = @SessionId, @ReferenceDate = @ReferenceDate,
         @ReferenceTypeNo = @ReferenceTypeNo, @AliasId = @AliasId, @AlternateId = @AlternateId,
         @Description = @desc, @StatusNo = @StatusNo, @OutReferenceId = @OutTermId OUTPUT
   END

   IF @TermId is null
   BEGIN
      INSERT INTO Data.DataTerm
         ( ReferenceDate,    OrganizationId,   DataOwnerId,
           ExpiredDate,      TermId,
           TermURI,          TermName,         Description,
           ConfidenceScore,  StatusNo)
      VALUES
         (@ReferenceDate,   @OrganizationId,  @DataOwnerId,
          @ExpiredDate,     @OutTermId,
          @TermURI,         @TermName,        @Description,
          @ConfidenceScore, @StatusNo)
   END
   ELSE
   BEGIN
      UPDATE Data.DataTerm
         SET ReferenceDate   = case when @ReferenceDate is null
                               then ReferenceDate else @ReferenceDate end,
             ExpiredDate     = case when @ExpiredDate is null
                               then ExpiredDate else @ExpiredDate end,
             TermURI         = case when @TermURI is null
                               then TermURI else @TermURI end,
             TermName        = case when @TermName is null
                               then TermName else @TermName end,
             Description     = case when @Description is null
                               then Description else @Description end,
             ConfidenceScore = case when @ConfidenceScore is null
                               then ConfidenceScore else @ConfidenceScore end,
             StatusNo        = case when @StatusNo is null
                               then StatusNo else @StatusNo end
       WHERE TermId = @OutTermId
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataReferenceGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Data.DataReferenceGet
   @SessionId       VARCHAR(40) = NULL,
   @OrganizationId  VARCHAR(20),
   @Root            VARCHAR(1024),
   @DomainUri       VARCHAR(2048),
   @TermName        VARCHAR(1024),
   @OptionNo        SMALLINT = 0 
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON
   IF @OptionNo = 0
   BEGIN
      EXEC Data.DataReferenceDomainGet @SessionId = @SessionId, 
         @OrganizationId = @OrganizationId, @Root = null, @DomainUri = @DomainUri
      EXEC Data.DataReferenceTermGet @SessionId = @SessionId, 
         @OrganizationId = @OrganizationId, @Root = @Root, @DomainUri = @DomainUri, @TermName = @TermName
      EXEC Data.DataReferenceElementGet @SessionId = @SessionId, 
         @OrganizationId = @OrganizationId, @Root = @Root, @DomainUri = @DomainUri
   END
   ELSE
   IF @OptionNo = 1
   BEGIN
      EXEC Data.DataReferenceDomainGet @SessionId = @SessionId, 
         @OrganizationId = @OrganizationId, @Root = @Root, @DomainUri = @DomainUri
   END
   ELSE
   IF @OptionNo = 2
   BEGIN
      EXEC Data.DataReferenceElementGet @SessionId = @SessionId, 
         @OrganizationId = @OrganizationId, @Root = @Root, @DomainUri = @DomainUri
   END
   ELSE
   IF @OptionNo = 3
   BEGIN
      EXEC Data.DataReferenceTermGet @SessionId = @SessionId, 
         @OrganizationId = @OrganizationId, @Root = @Root, @DomainUri = @DomainUri, @TermName = @TermName
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSchemaSetExecuteToAll]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Helper.HelperSchemaSetExecuteToAll
   @SchemaName      VARCHAR(80) = '',
   @ObjectName      VARCHAR(80) = '',
   @ViewerRoleName  VARCHAR(80) = 'kifDataViewerRole',
   @EntryRoleName   VARCHAR(80) = 'kifDataEntryRole',
   @EditorRoleName  VARCHAR(80) = 'kifDataEditorRole',
   @TestOnly        BIT = 0
AS
BEGIN
   EXEC Helper.HelperSchemaSetAccess
      @SchemaName, 'E', @ObjectName,
      @ViewerRoleName,@EntryRoleName,@EditorRoleName, 'PROCEDURE', @TestOnly
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Helper].[HelperSchemaProceduresSetAccess]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- -----------------------------------------------------------------------------

-- we asume that 'Helper.HelperDropProcedure' was added as done above...
-- drop procedure Helper.HelperSchemaProceduresSetAccess
CREATE PROCEDURE Helper.HelperSchemaProceduresSetAccess
   @CatalogName     VARCHAR(80) = '',
   @SchemaName      VARCHAR(80) = '',
   @ViewerRoleName  VARCHAR(80) = '',
   @EntryRoleName   VARCHAR(80) = '',
   @EditorRoleName  VARCHAR(80) = '',
   @TestOnly        BIT = 0
AS
BEGIN
   DECLARE @catalog VARCHAR(20),
           @schema  VARCHAR(20),
           @objName VARCHAR(80),
           @objType VARCHAR(20),
           @option  CHAR(1),
           @cmd     VARCHAR(128),
           @header  VARCHAR(80)

   SET @header          = 'GRANT EXECUTE ON '
   SET @SchemaName      = rtrim(@SchemaName)
   SET @CatalogName     = rtrim(@CatalogName)
   SET @ViewerRoleName  = rtrim(@ViewerRoleName)
   SET @EntryRoleName   = rtrim(@EntryRoleName)
   SET @EditorRoleName  = rtrim(@EditorRoleName)

   DECLARE SchmInitCursor CURSOR FOR
      SELECT Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM (

      -- 'F' = Find
      SELECT 'F' Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM Information_Schema.Routines
       WHERE (Routine_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Routine_Schema = @SchemaName OR @SchemaName = '')
         AND (Routine_Name like '%Get%'
          OR  Routine_Name like '%Find%')
       UNION
      -- 'M' = Modify
      SELECT 'M' Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM Information_Schema.Routines
       WHERE (Routine_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Routine_Schema = @SchemaName OR @SchemaName = '')
         AND (Routine_Name like '%Insert%'
          OR  Routine_Name like '%Update%'
          OR  Routine_Name like '%Add%'
          OR  Routine_Name like '%Create%')
       UNION
      -- 'D' = Delete
      SELECT 'D' Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM Information_Schema.Routines
       WHERE (Routine_Catalog = @CatalogName OR  @CatalogName = '')
         AND (Routine_Schema = @SchemaName OR @SchemaName = '')
         AND (Routine_Name like '%Delete%')
       UNION
      -- 'E' = Execution for the remainder
      SELECT 'E' Routine_Option, Routine_Schema, Routine_Name, Routine_Type
        FROM Information_Schema.Routines
       WHERE Routine_Type = 'PROCEDURE'
         AND Routine_Name NOT IN (
      SELECT Routine_Name
        FROM Information_Schema.Routines
       WHERE (Routine_Name like '%Get%'
          OR  Routine_Name like '%Find%')
       UNION
      SELECT Routine_Name
        FROM Information_Schema.Routines
       WHERE (Routine_Name like '%Insert%'
          OR  Routine_Name like '%Update%'
          OR  Routine_Name like '%Add%'
          OR  Routine_Name like '%Create%')
       UNION
      SELECT Routine_Name
        FROM Information_Schema.Routines
       WHERE (Routine_Name like '%Delete%'))
         AND Routine_Schema <> 'Helper') x
       ORDER BY Routine_Option, Routine_Schema, Routine_Name

   OPEN SchmInitCursor
   FETCH NEXT FROM SchmInitCursor
    INTO @option,@schema,@objName,@objType

   WHILE @@FETCH_STATUS = 0
   BEGIN
      -- setup permissions to users

      EXEC Helper.HelperSchemaSetAccess
         @schema,         @option,        @objName, 
         @ViewerRoleName, @EntryRoleName, @EditorRoleName,
         @objType,        @TestOnly

      --PRINT '---------------------------------------------------------------'

      -- Get the next table...
      FETCH NEXT FROM SchmInitCursor 
       INTO @option,@schema,@objName,@objType
   END 

   CLOSE SchmInitCursor
   DEALLOCATE SchmInitCursor
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataRecordProvide]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

CREATE PROCEDURE Reference.ReferenceDataRecordProvide
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @OperationType       SMALLINT,
   @RequestType         SMALLINT,
   @ReferenceObjectName VARCHAR(128),
   @Items               Reference.ReferenceDataElementCollectionItem READONLY,
   @OptionNo            SMALLINT = 0,
   @OutResult           VARCHAR(1024) OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON

   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataRecordProvide'
   --IF @diagrval <> 0
   --   RETURN @diagrval

   IF @OperationType not in (20,30)
      RETURN -112 -- Invalid Reference Data Operation

   -- 1 = check duplicate record, 2 = exists, 3 = select, 
   -- 4 = insert / update, 5 = delete, 6 = exec, 7 = record status update
   IF @RequestType not in (1,2,3,4,5,6,7)
      RETURN -113

   DECLARE @rval INTEGER

   -- 2 - Exists
   IF @RequestType in (1, 2, 4) -- check for 1 - duplicate, 2 - exists or 4 - insert/update
   BEGIN
      DECLARE @chk SMALLINT = case when @RequestType in (2,4) -- unique record exists?
                              then 0      -- 0 = unique record exists (keys only); 
                              else 1 end  -- 1 = duplicate record
      EXEC @rval = Reference.ReferenceDataRecordExists
         @SessionId           = @SessionId,
         @OrganizationId      = @OrganizationId,
         @OperationType       = @OperationType,
         @ReferenceObjectName = @ReferenceObjectName,
         @CheckRecord         = @chk,
         @Items               = @Items
	  IF @RequestType in (1,2)
	  BEGIN
	     IF @rval = 1
           SET @OutResult = 'true'
        ELSE
	        SET @OutResult = 'false'
	     RETURN @rval
      END
   END

   -- 3 - Select
   IF @RequestType = 3
   BEGIN
      EXEC @rval = Reference.ReferenceDataRecordGet
         @SessionId           = @SessionId,
         @OrganizationId      = @OrganizationId,
         @OperationType       = @OperationType,
         @ReferenceObjectName = @ReferenceObjectName,
         @Items               = @Items
	   IF @rval >= 0
	      SET @OutResult = 'success'
	   ELSE
	      SET @OutResult = 'failed'
      RETURN @rval
   END

   -- 4 - Insert
   IF @RequestType = 4 and @rval = 0
   BEGIN
      EXEC @rval = Reference.ReferenceDataRecordInsert
         @SessionId           = @SessionId,
         @OrganizationId      = @OrganizationId,
         @OperationType       = @OperationType,
         @ReferenceObjectName = @ReferenceObjectName,
         @Items               = @Items
	   IF @rval >= 0
	      SET @OutResult = 'success'
	   ELSE
	      SET @OutResult = 'failed'
      RETURN @rval
   END
   ELSE
   -- 4 - Update
   IF @RequestType = 4
   BEGIN
      EXEC @rval = Reference.ReferenceDataRecordUpdate
         @SessionId           = @SessionId,
         @OrganizationId      = @OrganizationId,
         @OperationType       = @OperationType,
         @ReferenceObjectName = @ReferenceObjectName,
         @Items               = @Items
	   IF @rval >= 0
	      SET @OutResult = 'success'
	   ELSE
	      SET @OutResult = 'failed'
      RETURN @rval
   END

   -- 6 - Exec Store Proc
   IF @RequestType = 6
   BEGIN
      EXEC @rval = Reference.ReferenceDataRecordCallProcedure
         @SessionId           = @SessionId,
         @OrganizationId      = @OrganizationId,
         @OperationType       = @OperationType,
         @ReferenceObjectName = @ReferenceObjectName,
         @Items               = @Items,
         @OptionNo            = @OptionNo,
         @OutResult           = @OutResult OUTPUT
      RETURN @rval
   END

   -- 7 - Update Table Record Status Code
   IF @RequestType = 7
   BEGIN
      EXEC @rval = Reference.ReferenceDataRecordStatusUpdate
         @SessionId           = @SessionId,
         @OrganizationId      = @OrganizationId,
         @OperationType       = @OperationType,
         @ReferenceObjectName = @ReferenceObjectName,
         @Items               = @Items,
         @OptionNo            = @OptionNo
	   IF @rval >= 0
	      SET @OutResult = 'success'
	   ELSE
	      SET @OutResult = 'failed'
      RETURN @rval
   END

END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Reference].[ReferenceDataTemplateGet]...';


GO
SET ANSI_NULLS ON;

SET QUOTED_IDENTIFIER OFF;


GO

-- @OptionNo: 0 | null - returns all
-- @OptionNo: 1        - get template data
-- @OptionNo: 2        - get template groups
-- @OptionNo: 3        - get map/links
-- @OptionNo: 4        - get template and groups
-- @OptionNo: 5        - get template, and map/links
-- @OptionNo: 32767    - get all templates

CREATE PROCEDURE Reference.ReferenceDataTemplateGet
   @SessionId           VARCHAR(40),
   @OrganizationId      VARCHAR(20),
   @ReferenceObjectName VARCHAR(128) = null,
   @TemplateNo          BIGINT = null,
   @GroupNo             BIGINT = null,
   @OptionNo            SMALLINT = 4
WITH EXECUTE AS 'KifDbReader'
AS
BEGIN
   SET NOCOUNT ON

   --DECLARE @diagrval INTEGER
   --EXEC @diagrval = Application.ApplicationSessionValidate @SessionId, @OrganizationId, 
   --   '', 'Reference.ReferenceDataTemplateGet'
   --IF @diagrval <> 0
   --   RETURN @diagrval

   IF @ReferenceObjectName = ''
      SET @ReferenceObjectName = null

   SELECT CreatedDate,
          LastUpdateDate,
          OrganizationId,
          TemplateNo,
          TemplateVersionId,
          ResourceName,
          TemplateDefaultNo,
          TemplateTypeNo,
          TemplateData,
          MapData,
          GroupData,
          Title,
          GroupNo,
          ScopeNo,
          StatusNo,
          PostUpdateScript
     FROM Reference.ReferenceDataEditTemplate
    WHERE OrganizationId = @OrganizationId
      AND (ResourceName = @ReferenceObjectName
      AND  @ReferenceObjectName is not null)
       OR (TemplateNo = @TemplateNo
      AND  @TemplateNo is not null)
       OR (GroupNo = @GroupNo
      AND  @GroupNo is not null)
       OR (@GroupNo = 32767)

   SELECT GroupNo CodeId,
          GroupName Value
     FROM Reference.ReferenceDataEditGroup
    WHERE OrganizationId = @OrganizationId
      AND (GroupNo = @GroupNo
      AND  @GroupNo is not null)
       OR (@GroupNo = 32767)

   -- MAP DATA - is requested after Reference.ReferenceDataRecordGet
   IF (@OptionNo is null or @OptionNo in (0,3,5)) and
      (@TemplateNo is not null)
   BEGIN
      EXEC Reference.ReferenceDataTemplateMappingGet 
         @SessionId, @OrganizationId, @TemplateNo, @ReferenceObjectName
   END
END
GO
SET ANSI_NULLS, QUOTED_IDENTIFIER ON;


GO
PRINT N'Creating Procedure [Data].[DataElementUpsert]...';


GO

CREATE PROCEDURE Data.DataElementUpsert
   @SessionId        VARCHAR(40) = NULL,
   @OrganizationId   VARCHAR(20),
   @DataOwnerId      VARCHAR(20),
   @ReferenceDate    DATETIME = null,
   @DomainUri        VARCHAR(80),
   @DomainUriPrefix  VARCHAR(20),
   @DomainName       VARCHAR(20),
	 
   @ExpiredDate      DATETIME = null,
   @AssetNo          INTEGER = null,
   @AssetTypeNo      INTEGER = null,

   @Root             VARCHAR(1024) = null,
   @Domain           VARCHAR(2048) = null,
   @Type             VARCHAR(256) = null,
   @Element          VARCHAR(256) = null,
   @ElementNo        INTEGER,
   @ParentNo         INTEGER,
   @ElementId        VARCHAR(20) = null,
   @TypeNo           INTEGER = 0,
   @ElementURI       VARCHAR(2048) = null,
   @ElementName      VARCHAR(80) = null,
   @ElementType      VARCHAR(20),
   @ElementDataType  VARCHAR(1024),
   @ElementPath      VARCHAR(MAX),
   @Description      VARCHAR(MAX) = null,
   @ElementSequenceID   VARCHAR(128) = null,
   @ElementTypeNo       INTEGER = 0,
   @ElementGroupNo      INTEGER = 0,
   @ElementConstraintNo INTEGER = 0,
   @ElementKeyTypeNo    INTEGER = 0,
   @AutoGeneratedTypeNo INTEGER = 0,
   @StatusNo         INTEGER = 0,
   @ValueTypeNo      SMALLINT = 0,
   @MinLength        INTEGER = 0,
   @MaxLength        INTEGER = 0,
   @MinOccurrence    INTEGER = 0,
   @MaxOccurrence    INTEGER = 0,
   @Nillable         BIT = 0,
   @DefaultValue     VARCHAR(128) = null,
   @FixedValue       VARCHAR(128) = null,
   @SampleValue      VARCHAR(128) = null,
   @PropertiesBagText          VARCHAR(MAX) = null,
   @ProcessInstructionsBagText VARCHAR(MAX) = null,
   @SchemaText       VARCHAR(MAX) = null,
   @OrdinalNo        INTEGER = 0,
   @SequenceID       VARCHAR(20) = null,
   @VersionID        VARCHAR(20) = null,
   @BatchID          VARCHAR(40) = null,

   @ConstraintsText  VARCHAR(MAX) = null,
   @KindNo           SMALLINT = 0,
   @Tags             VARCHAR(128) = null,

   @OriginalName     VARCHAR(128) = null,
   @OriginalDataType VARCHAR(128) = null,
	 
   @OutAssetNo       INTEGER OUTPUT,
   @OutElementNo     INTEGER OUTPUT,
   @OutElementId     VARCHAR(20) OUTPUT
WITH EXECUTE AS 'KifDbWriter'
AS
BEGIN
   SET NOCOUNT ON
			
   IF @OrganizationId = ''    or @Root = ''    or @Domain = ''	  	or @ElementUri = '' or
      @OrganizationId is null or @Root is null or @Domain is null	or @Type is null	or @ElementUri is null
   BEGIN
      RAISERROR (50001,18,1)
   END			
			
   SET @OutElementId = @ElementId
   SET @OutElementNo = @ElementNo
   
   DECLARE @referenceTypeNo SMALLINT,
           @aliasId         VARCHAR(20) = NULL,
           @alternateId     VARCHAR(40) = NULL,
           @domainNo        INTEGER,
           @outDid          VARCHAR(20),
           @outDno          VARCHAR(20)

   -- register domain if it does not exists, or just fetch ID's
   EXEC Data.DataDomainUpsert
      @SessionId       = @SessionId,
      @OrganizationId  = @OrganizationId,
      @DomainNo        = @AssetNo,
      @DomainId        = null,
      @DataOwnerId     = @DataOwnerId,
      @ReferenceDate   = @ReferenceDate,
      @DomainUri       = @DomainUri,
      @DomainUriPrefix = @DomainUriPrefix,
      @Root            = @Root,
      @Domain          = 'asset',
      @DomainName      = @DomainName,
      @TypeNo          = @AssetTypeNo,
      @Description     = null,
      @OptionNo        = 1,  -- return with output vars if exists
      @OutDomainID     = @outDid OUTPUT,
      @OutDomainNo     = @outDno OUTPUT
			
   SET @domainNo = @outDno
   SET @OutAssetNo = @outDno

   IF @AliasId is null
      SET @AliasId = 'OBJ'
   IF @ReferenceDate is null
      SET @ReferenceDate = getutcdate()
   IF @referenceTypeNo is null
      SET @referenceTypeNo = 40  -- Element
   IF @StatusNo is null
      SET @StatusNo = 1          -- active
   IF @OutElementId = ''
      SET @OutElementId = null

   -- check that the record don't exists...
   DECLARE @eid VARCHAR(20),
           @eno INTEGER

   SELECT @eid = ElementId,
          @eno = ElementNo
     FROM Data.DataElement
    WHERE (OrganizationId = @OrganizationId
      AND  Root = @Root
      AND  Domain = @Domain
      AND  Type = @Type
      AND  Element = @Element
      AND  VersionId = @VersionID
      AND  ElementUri = @ElementUri)
       OR (ElementNo = @ElementNo
       OR  ElementId = @ElementId)
							
   SET @OutElementId = @eid
   SET @OutElementNo = @eno

   -- register object as needed
   IF @OutElementId is null
   BEGIN
      DECLARE @desc VARCHAR(1024) = 'Reference (' + @ElementName + ')'
      EXEC Data.DataReferenceObjectNew @SessionId = @SessionId, @ReferenceDate = @ReferenceDate,
         @ReferenceTypeNo = @ReferenceTypeNo, @AliasId = @aliasId, @AlternateId = @alternateId,
         @Description = @desc, @StatusNo = @StatusNo, @OutReferenceId = @OutElementId OUTPUT
   END
			
   -- insert or update data element record
   IF @OutElementNo is NULL
   BEGIN
      INSERT INTO Data.DataElement (
         ReferenceDate,    OrganizationId,    ExpiredDate,
         Root,             Domain,            Type,
         Element,          ElementId,         TypeNo,
         ElementUri,       ElementName,       ElementType,
         ElementDataType,  ElementPath,       Description,
         ElementTypeNo,    StatusNo,          ValueTypeNo,
         MinLength,        MaxLength,         MinOccurrence,
         MaxOccurrence,    Nillable,          DefaultValue,
         FixedValue,       SampleValue,       DataOwnerId,
         PropertiesBagText,SchemaText,        SequenceId,
         VersionId,        UpdateSessionId,   ElementConstraintNo,
         ElementGroupNo,   ElementKeyTypeNo,  AssetNo,
         ParentNo,         ElementSequenceID, AutoGeneratedTypeNo,
         OrdinalNo,        BatchID,           ProcessInstructionsBagText,
         KindNo,           ConstraintsText,   Tags,
         OriginalName,     OriginalDataType,  DomainNo)
      VALUES  (
         @ReferenceDate,   @OrganizationId,   @ExpiredDate,
         @Root,            @Domain,           @Type,
         @Element,         @OutElementId,     @TypeNo,
         @ElementUri,      @ElementName,      @ElementType,
         @ElementDataType, @ElementPath,      @Description,
         @ElementTypeNo,   @StatusNo,         @ValueTypeNo,
         @MinLength,       @MaxLength,        @MinOccurrence,
         @MaxOccurrence,   @Nillable,         @DefaultValue,
         @FixedValue,      @SampleValue,      @DataOwnerId,
         @PropertiesBagText,@SchemaText,       @SequenceId,
         @VersionId,       @SessionId,        @ElementConstraintNo,
         @ElementGroupNo,  @ElementKeyTypeNo, @domainNo,
         @ParentNo,        @ElementSequenceID,@AutoGeneratedTypeNo,
         @OrdinalNo,       @BatchID,          @ProcessInstructionsBagText,
         @KindNo,          @ConstraintsText,  @Tags,
         @OriginalName,    @OriginalDataType, @domainNo)
      SET @OutElementNo = @@IDENTITY
   END
   ELSE
   -- Update a record only, if something had changed
   IF NOT EXISTS(
      SELECT * 
        FROM Data.DataElement
       WHERE AssetNo = @domainNo
         AND ReferenceDate = @ReferenceDate
         AND ExpiredDate = @ExpiredDate
         AND ElementName = @ElementName
         AND ElementType = @ElementType
         AND ElementDataType = @ElementDataType
         AND ElementPath = @ElementPath
         AND Description = @Description
         AND ElementTypeNo = @ElementTypeNo
         AND ElementGroupNo = @ElementGroupNo
         AND ElementConstraintNo = @ElementConstraintNo
         AND ElementKeyTypeNo = @ElementDataType
         AND StatusNo = @StatusNo
         AND ValueTypeNo = @ValueTypeNo
         AND MinLength = @MinLength
         AND MaxLength = @MaxLength
         AND MinOccurrence = @MinOccurrence
         AND MaxOccurrence = @MaxOccurrence
         AND Nillable = @Nillable
         AND DefaultValue = @DefaultValue
         AND FixedValue = @FixedValue
         AND SampleValue = @SampleValue
         AND PropertiesBagText = @PropertiesBagText
         AND ProcessInstructionsBagText = @ProcessInstructionsBagText
         AND SchemaText = @SchemaText
         AND SequenceId = @SequenceId
         AND VersionId = @VersionId
         AND OrganizationId = @OrganizationId
         AND ElementNo = @ElementNo
         AND ElementId = @OutElementId
         AND KindNo = @KindNo
         AND Tags = @Tags
         AND ConstraintsText = @ConstraintsText
         AND OriginalName = @OriginalName
         AND OriginalDataType = @OriginalDataType)
   BEGIN
      UPDATE Data.DataElement
         SET ReferenceDate = @ReferenceDate,
             ExpiredDate = @ExpiredDate,
             ElementName = @ElementName,
             ElementType = @ElementType,
             ElementDataType = @ElementDataType,
             ElementPath = @ElementPath,
             Description = @Description,
             ElementTypeNo = @ElementTypeNo,
             ElementGroupNo = @ElementGroupNo,
             ElementConstraintNo = @ElementConstraintNo,
             ElementKeyTypeNo = @ElementKeyTypeNo,
             StatusNo = @StatusNo,
             ValueTypeNo = @ValueTypeNo,
             MinLength = @MinLength,
             MaxLength = @MaxLength,
             MinOccurrence = @MinOccurrence,
             MaxOccurrence = @MaxOccurrence,
             Nillable = @Nillable,
             DefaultValue = @DefaultValue,
             FixedValue = @FixedValue,
             SampleValue = @SampleValue,
             PropertiesBagText = @PropertiesBagText,
             ProcessInstructionsBagText = @ProcessInstructionsBagText,
             SchemaText = @SchemaText,
             SequenceId = @SequenceId,
             VersionId = @VersionId,
             UpdateSessionId = @SessionId,
             OrdinalNo = @OrdinalNo,
             ParentNo = @ParentNo,
             ElementSequenceID = @ElementSequenceID,
             AutoGeneratedTypeNo = @AutoGeneratedTypeNo,
             LastUpdateDate = getutcdate(),
             KindNo = @KindNo,
             Tags = @Tags,
             ConstraintsText = @ConstraintsText,
             OriginalName = @OriginalName,
             OriginalDataType = @OriginalDataType
       WHERE OrganizationId = @OrganizationId
         AND AssetNo = @AssetNo
         AND ElementNo = @ElementNo
         AND ElementId = @OutElementId
   END
END
GO
PRINT N'Creating Permission Permission...';


GO
GRANT CONNECT TO [KifDbReader];


GO
PRINT N'Creating Permission Permission...';


GO
GRANT CONNECT TO [KifDbWriter];


GO
PRINT N'Creating Permission Permission...';


GO
GRANT CONNECT TO [KifReader];


GO
PRINT N'Creating Permission Permission...';


GO
GRANT CONNECT TO [KifReportReader];


GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
